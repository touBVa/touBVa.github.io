<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Dreamhack-basic_exploitation_001 문제 풀이 - TouBVa </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="basic_exploitation_001 문제 풀이- Dreamhack-basic_exploitation_001 문제 풀이"> <meta name="keywords" content="Dreamhack-basic_exploitation_001 문제 풀이, TouBVa, system_hacking,system, BOF"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="TouBVa" property="og:site_name" /> <meta content="Dreamhack-basic_exploitation_001 문제 풀이" property="og:title" /> <meta content="article" property="og:type" /> <meta content="basic_exploitation_001 문제 풀이" property="og:description" /> <meta content="http://0.0.0.0:4000/blog/dreamhack_system_hacking/2024-12-01-basic_exploitation_001" property="og:url" /> <meta content="2024-12-01T01:00:00-06:00" property="article:published_time" /> <meta content="http://0.0.0.0:4000/about/" property="article:author" /> <meta content="http://0.0.0.0:4000/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled.png" property="og:image" /> <meta content="system_hacking" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Dreamhack-basic_exploitation_001 문제 풀이" /> <meta name="twitter:url" content="http://0.0.0.0:4000/blog/dreamhack_system_hacking/2024-12-01-basic_exploitation_001" /> <meta name="twitter:description" content="basic_exploitation_001 문제 풀이" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://0.0.0.0:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://0.0.0.0:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://0.0.0.0:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://0.0.0.0:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://0.0.0.0:4000/assets/js/search.js"></script> <script src="http://0.0.0.0:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark nav-down" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">TouBVa</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/contact" >Contact</a > </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/styleguide"> Styleguide </a> </li> --> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- <li class="nav-item" style="margin-top:5px; padding-right:20px;" > <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill"></path> </svg> <span class="snipcart-items-count"></span> <span class="snipcart-total-price"></span> </a> </li> --> <script type="text/javascript"> var didScroll; var lastScrollTop = 0; var delta = 5; var navbarHeight = document.querySelector('#topNav').offsetHeight; window.addEventListener('scroll', function(event) { didScroll = true; }); setInterval(function() { if (didScroll) { hasScrolled(); didScroll = false; } }, 250); function hasScrolled() { var st = window.pageYOffset || document.documentElement.scrollTop; if (Math.abs(lastScrollTop - st) <= delta) return; var nav = document.querySelector('#topNav'); var prog = document.querySelector('#progress-bar'); if (st > lastScrollTop && st > navbarHeight) { nav.classList.remove('nav-down'); nav.classList.add('nav-up'); prog.classList.remove('toDown'); prog.classList.add('toUp'); } else { if (st < lastScrollTop) { nav.classList.remove('nav-up'); nav.classList.add('nav-down'); prog.classList.remove('toUp'); prog.classList.add('toDown'); } } lastScrollTop = st; } </script> <!-- <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> --> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Dreamhack-basic_exploitation_001 문제 풀이</h1> <h4 class="post-meta">basic_exploitation_001 문제 풀이</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://0.0.0.0:4000/blog/authors/TouBVa">TouBVa</a></span> </span > at <time datetime="2024-12-01 01:00:00 -0600" itemprop="datePublished" >Dec 1, 2024</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/dreamhack_system_hacking/2024-12-01-basic_exploitation_001" ></span> <div class="post-categories"> Category : <a href="/blog/categories/system_hacking" >system_hacking</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top " src="http://0.0.0.0:4000/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled.png" alt="" style="height: 50%; width: 50%; display: block; margin-left: auto; margin-right: auto;" /> <br /> <br /> <ul id="markdown-toc"> <li><a href="#0-파일-메타데이터-확인" id="markdown-toc-0-파일-메타데이터-확인">0. 파일 메타데이터 확인</a></li> <li><a href="#1-파일-동작-확인" id="markdown-toc-1-파일-동작-확인">1. 파일 동작 확인</a></li> <li><a href="#2-pwndbg로-확인" id="markdown-toc-2-pwndbg로-확인">2. pwndbg로 확인</a> <ul> <li><a href="#21-main-분석" id="markdown-toc-21-main-분석">2.1. main 분석</a></li> <li><a href="#22-read_flag-분석" id="markdown-toc-22-read_flag-분석">2.2. read_flag 분석</a></li> </ul> </li> <li><a href="#3-페이로드-작성" id="markdown-toc-3-페이로드-작성">3. 페이로드 작성</a> <ul> <li><a href="#31-에러-해결-gdbattach시-gdb가-붙지-못하는-오류" id="markdown-toc-31-에러-해결-gdbattach시-gdb가-붙지-못하는-오류">3.1. 에러 해결-gdb.attach시 gdb가 붙지 못하는 오류</a></li> </ul> </li> </ul> <p><br /></p> <p>소스가 주어진 문제로, 소스를 보고 수행한다면 훨씬 쉽지만 어셈블리 감각을 유지하기 위해 소스를 보지 않고 디버거로 파일을 파악했다.</p> <p><br /></p> <h2 id="0-파일-메타데이터-확인">0. 파일 메타데이터 확인</h2> <p><br /></p> <p><img src="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled.png" alt="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled.png" width="100%" height="100%" /></p> <p><br /></p> <p>NX enabled</p> <p>단순히 스택에 쉘코드 넣는 걸론 안될듯?</p> <p><code class="language-plaintext highlighter-rouge">file</code>, <code class="language-plaintext highlighter-rouge">readelf -h</code> 로 일단은 체크함, not stripped / ELF32</p> <p><br /></p> <h2 id="1-파일-동작-확인">1. 파일 동작 확인</h2> <p><br /></p> <p><img src="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_1.png" alt="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_1.png" width="100%" height="100%" /></p> <p><br /></p> <p>그냥 실행해서는 아무것도 알 수 없음</p> <p><br /></p> <h2 id="2-pwndbg로-확인">2. pwndbg로 확인</h2> <p><br /></p> <p><img src="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_2.png" alt="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_2.png" width="100%" height="100%" /></p> <p><br /></p> <p>누가 봐도 <code class="language-plaintext highlighter-rouge">read_flag</code>에 뭔가 있어 보인다</p> <p>일단은 <code class="language-plaintext highlighter-rouge">main</code> 함수부터 분석하자</p> <p><br /></p> <h3 id="21-main-분석">2.1. main 분석</h3> <p><br /></p> <p><img src="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_3.png" alt="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_3.png" width="100%" height="100%" /></p> <p><br /></p> <p>그런데 이거 왜 line3에서 <code class="language-plaintext highlighter-rouge">add esp, 0xffffff80</code>이라고 한 거지?</p> <p>부동소수점 표현방식 생각했을 때 <code class="language-plaintext highlighter-rouge">sub esp, 0x80</code>이라고 하면 편할 텐데</p> <p>아무튼 <code class="language-plaintext highlighter-rouge">0x80</code>만큼의 버퍼를 할당하고, 그 시작 주소를 <code class="language-plaintext highlighter-rouge">gets</code>의 인자로 주는군요</p> <p><code class="language-plaintext highlighter-rouge">gets</code>는 입력값 길이를 설정하지 않은 취약한 함수이므로 그 취약점을 이용해 보자</p> <p>NX는 설정되어 있으니 쉘코드를 스택에 넣는 걸로는 안될 거고</p> <p>그럼 내부에서 쓸만한 함수가 있을 경우 RET addr를 그쪽으로 변경하면 되겠다</p> <p>그리고 그 쓸만한 함수는 아마 <code class="language-plaintext highlighter-rouge">read_flag</code> 아닐까?</p> <p><br /></p> <h3 id="22-read_flag-분석">2.2. read_flag 분석</h3> <p><br /></p> <p><img src="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_4.png" alt="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_4.png" width="100%" height="100%" /></p> <p><br /></p> <p>오케이! 이쪽으로 RET addr를 리다이렉트 해주면 되겠다</p> <p><br /></p> <h2 id="3-페이로드-작성">3. 페이로드 작성</h2> <p><br /></p> <p>0x80(dump)+0x04(rbp contamination)+0x080485b9</p> <p>로컬 프로그램에 시도해 보았다.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./basic_exploitation_001'</span><span class="p">)</span>
<span class="n">p</span><span class="o">=</span><span class="n">remote</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
<span class="c1"># context.terminal = ["bash"]payload=b'A'*0x80payload+=b'B'*0x4payload+= p32(0x080485b9, endian='little')
# gdb.attach(p, gdbscript='b *(main+20)')# input('1')p.sendline(payload )
</span><span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div> <p><br /></p> <h3 id="31-에러-해결-gdbattach시-gdb가-붙지-못하는-오류">3.1. 에러 해결-gdb.attach시 gdb가 붙지 못하는 오류</h3> <p><br /></p> <p>하지만 gdb.attach를 수행 시 아래와 같은 에러가 뜬다.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">terminal</span> <span class="n">binary</span> <span class="s">'vscode'</span><span class="p">.</span> <span class="n">Set</span> <span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="n">to</span> <span class="n">your</span> <span class="n">terminal</span><span class="p">.</span>
</code></pre></div></div> <p>보통 이 에러가 뜨면 <code class="language-plaintext highlighter-rouge">context.terminal = ["tmux", "splitw", "-h"]</code> 를 코드에 추가해 context.terminal을 명시적으로 정의하여 gdb가 돌 수 있는 터미널 응용 프로그램을 지정하라고 한다.</p> <p>일반적으로 이렇게 하면 해결되고… 하지만 난 해결이 안 됐다. gdb가 붙지 못하고 먼저 죽어버리는 것이었다.</p> <p>에러 메시지에는 ptrace의 실행 권한을 확인하라고만 나와 있었는데, 난 이미 해당 플래그를 편집해 모든 프로세스가 디버깅을 위해 ptrace를 사용 가능하도록 열어둔 상태였고 터미널의 환경 변수도 정상적으로 적용되어 있었다.</p> <p>그래서 <a href="https://github.com/Gallopsled/pwntools/blob/dev/pwnlib/util/misc.py">에러가 뜬 소스</a>를 직접 확인해 봤다.</p> <p><br /></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">run_in_new_terminal</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">terminal</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">kill_at_exit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">preexec_fn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""run_in_new_terminal(command, terminal=None, args=None, kill_at_exit=True, preexec_fn=None) -&gt; int    Run a command in a new terminal.    When ``terminal`` is not set:        - If ``context.terminal`` is set it will be used.          If it is an iterable then ``context.terminal[1:]`` are default arguments.        - If a ``pwntools-terminal`` command exists in ``$PATH``, it is used        - If tmux is detected (by the presence of the ``$TMUX`` environment          variable), a new pane will be opened.        - If GNU Screen is detected (by the presence of the ``$STY`` environment          variable), a new screen will be opened.        - If ``$TERM_PROGRAM`` is set, that is used.        - If X11 is detected (by the presence of the ``$DISPLAY`` environment          variable), ``x-terminal-emulator`` is used.        - If KDE Konsole is detected (by the presence of the ``$KONSOLE_VERSION``          environment variable), a terminal will be split.        - If WSL (Windows Subsystem for Linux) is detected (by the presence of          a ``wsl.exe`` binary in the ``$PATH`` and ``/proc/sys/kernel/osrelease``          containing ``Microsoft``), a new ``cmd.exe`` window will be opened.    If `kill_at_exit` is :const:`True`, try to close the command/terminal when the    current process exits. This may not work for all terminal types.    Arguments:        command (str): The command to run.        terminal (str): Which terminal to use.        args (list): Arguments to pass to the terminal        kill_at_exit (bool): Whether to close the command/terminal on process exit.        preexec_fn (callable): Callable to invoke before exec().
</span></code></pre></div></div> <p><br /></p> <p>시스템 터미널 환경에 어떤 커스텀이 적용되어 있으면, 그것을 확인해 해당 커스텀이 추가해 둔 시스템의 환경 변수를 읽어와서 새로운 터미널 프로세스를 fork할 때 exec의 커맨드로 주는 메커니즘인 것 같았다.</p> <p>따라서 <code class="language-plaintext highlighter-rouge">printenv</code> 명령어로 현재 사용자 프로파일에 정의된 환경 변수 중, 위의 설명에 언급된 것이 있는지 여부를 확인해 보았다.</p> <ol> <li> <p>vscode shell-우선순위에 따라 TERM_PROGRAM 환경변수를 우선 참조한다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tv@tv-virtual-machine:~/system_hacking/basic_exploitation_001.d<span class="nv">$ </span><span class="nb">export</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"PATH|TMUX|STY|TERM_PROGRAM|DISPLAY|KONSOLE_VERSION"</span><span class="nb">declare</span> <span class="nt">-x</span> <span class="nv">DISPLAY</span><span class="o">=</span><span class="s2">":0"</span><span class="nb">declare</span> <span class="nt">-x</span> <span class="nv">GNOME_SETUP_DISPLAY</span><span class="o">=</span><span class="s2">":1"</span><span class="nb">declare</span> <span class="nt">-x</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">"/home/tv/.local/bin:/home/tv/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin"</span><span class="nb">declare</span> <span class="nt">-x</span> <span class="nv">TERM_PROGRAM</span><span class="o">=</span><span class="s2">"vscode"</span><span class="nb">declare</span> <span class="nt">-x</span> <span class="nv">TERM_PROGRAM_VERSION</span><span class="o">=</span><span class="s2">"1.90.2"</span><span class="nb">declare</span> <span class="nt">-x</span> <span class="nv">WAYLAND_DISPLAY</span><span class="o">=</span><span class="s2">"wayland-0"</span>
</code></pre></div> </div> </li> <li> <p>system shell(/etc/passwd의 마지막 필드에 정의된 사용자의 기본 쉘)-위의 설명이 나열한 것 중 DISPLAY 환경변수밖에 없어, X11(리눅스 GUI 환경)임을 탐지하고 심링크로 설정된(x-terminal-emulator는 일종의 perl 스크립트와 연결되어 users’ preferred terminal binary로 심링크를 타게 해준다) 유저 기본 터미널을 실행하게 된다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tv@tv-virtual-machine:~/system_hacking/basic_exploitation_001.d<span class="nv">$ </span><span class="nb">printenv</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="s2">"PATH|TMUX|STY|TERM_PROGRAM|DISPLAY|KONSOLE_VERSION"</span><span class="nv">WAYLAND_DISPLAY</span><span class="o">=</span>wayland-0
 <span class="nv">GNOME_SETUP_DISPLAY</span><span class="o">=</span>:1
 <span class="nv">DISPLAY</span><span class="o">=</span>:0
 <span class="nv">PATH</span><span class="o">=</span>/home/tv/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/snap/bin
</code></pre></div> </div> </li> </ol> <p><br /></p> <p>그리고 vscode shell에서 vscode 명령어를 실행하면 아무것도 실행되지 않는다. 즉, 최초로 등장했던 아래의 오류는 vscode라는 명령어 바이너리가 없어서였던 것이다!</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">terminal</span> <span class="n">binary</span> <span class="s">'vscode'</span><span class="p">.</span> <span class="n">Set</span> <span class="n">context</span><span class="p">.</span><span class="n">terminal</span> <span class="n">to</span> <span class="n">your</span> <span class="n">terminal</span><span class="p">.</span>
</code></pre></div></div> <p><br /></p> <p>자… 그럼 이제 어떻게 해야 할까?</p> <p>저 환경변수 자체를 바꿔버리거나, vscode라는 바이너리를 /usr/bin/에 만들어서 내부 스크립트로 기본 터미널에 심링크를 걸거나(~/.profile 참조), 아니면 숨어 있는 vscode 바이너리를 찾아내서 해당 바이너리의 path를 추가하거나(find 명령어 이용)</p> <p>그런데 그건 vscode shell을 써야만 할 때의 이야기고</p> <p>나는 그냥 쉽게 시스템 기본 쉘을 썼다.</p> <p><br /></p> <p>드림핵에서 가상머신 할당했는데 무슨 이유에서인지 접근이 안 돼서….</p> <p>로컬 파일 익스한 것만 올린다.</p> <p><img src="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_5.png" alt="/assets/img/posts/2024-12-01-basic_exploitation_001/Untitled_5.png" width="100%" height="100%" /></p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://0.0.0.0:4000/blog/dreamhack_system_hacking/2024-12-01-basic_exploitation_001" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About TouBVA </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="http://0.0.0.0:4000/assets/img/authors/toubva.jpeg" alt="TouBVA" /> </div> <div class="col-md-6"> <p class="author_bio">A Security Researcher, now concentrating on Security Consulting.</p> <p>Email : touBVa@gmail.com</p> <p>Website : https://toubva.github.io</p> <p class="profile-links"> <a class="social-link" href="https://github.com/TouBVa" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/johndoe" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.youtube.com/channel/UCSfLBFFfNU9r6ihfei6VeJw" target="_blank"><i class="fab fa-youtube fa-fw"></i></a> <a class="social-link" href="https://www.facebook.com/johndoe" target="_blank"><i class="fab fa-facebook fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/johndoe" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </p> </div> </div> </div> </div> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <div id="disqus_thread", style="width: 90%; margin-left: 5%;"><script> var disqus_config = function () { this.page.url = "http://0.0.0.0:4000/blog/dreamhack_system_hacking/2024-12-01-basic_exploitation_001"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/dreamhack_system_hacking/basic_exploitation_001"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://toubva.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About TouBVa</div> <div class="card-body"> <p class="author_bio">Welcome to my world!</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/touBVa/touBVa.github.io" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star my blog on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#dreamhack_system_hacking"></div> <li class="tag-head"> <a href="/blog/categories/dreamhack_system_hacking">dreamhack_system_hacking</a> </li> <a name="dreamhack_system_hacking"></a> <div id="#system_hacking"></div> <li class="tag-head"> <a href="/blog/categories/system_hacking">system_hacking</a> </li> <a name="system_hacking"></a> <div id="#protostar"></div> <li class="tag-head"> <a href="/blog/categories/protostar">protostar</a> </li> <a name="protostar"></a> <div id="#certification_study"></div> <li class="tag-head"> <a href="/blog/categories/certification_study">certification_study</a> </li> <a name="certification_study"></a> <div id="#paper_study"></div> <li class="tag-head"> <a href="/blog/categories/paper_study">paper_study</a> </li> <a name="paper_study"></a> <div id="#network_hacking"></div> <li class="tag-head"> <a href="/blog/categories/network_hacking">network_hacking</a> </li> <a name="network_hacking"></a> <div id="#blockchain"></div> <li class="tag-head"> <a href="/blog/categories/blockchain">blockchain</a> </li> <a name="blockchain"></a> <div id="#reversing"></div> <li class="tag-head"> <a href="/blog/categories/reversing">reversing</a> </li> <a name="reversing"></a> <div id="#fuzzing"></div> <li class="tag-head"> <a href="/blog/categories/fuzzing">fuzzing</a> </li> <a name="fuzzing"></a> <div id="#my_life"></div> <li class="tag-head"> <a href="/blog/categories/my_life">my_life</a> </li> <a name="my_life"></a> <div id="#web_hacking"></div> <li class="tag-head"> <a href="/blog/categories/web_hacking">web_hacking</a> </li> <a name="web_hacking"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://0.0.0.0:4000/">Home</a> </li> <li> <a href="http://0.0.0.0:4000/about">About</a> </li> <li> <a href="http://0.0.0.0:4000/blog">Blog</a> </li> <li> <a href="http://0.0.0.0:4000/contact">Contact</a> </li> </div> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action=""method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup for Weekly Email Newsletters :D</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div><footer> <p> Powered by<a href="https://github.com/touBVa"> TouBVa</a>. Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="http://0.0.0.0:4000/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
