<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Dreamhack-Reversing-Chaining 문제 풀이 - TouBVa </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Chaining 문제 풀이- Dreamhack-Reversing-Chaining 문제 풀이"> <meta name="keywords" content="Dreamhack-Reversing-Chaining 문제 풀이, TouBVa, reversing,reversing, rop chaining"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="TouBVa" property="og:site_name" /> <meta content="Dreamhack-Reversing-Chaining 문제 풀이" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Chaining 문제 풀이" property="og:description" /> <meta content="http://localhost:4000/blog/paper_study/reversing/chaining" property="og:url" /> <meta content="2023-08-31T13:05:23+09:00" property="article:published_time" /> <meta content="http://localhost:4000/about/" property="article:author" /> <meta content="http://localhost:4000/assets/img/posts/chaining/Untitled.png" property="og:image" /> <meta content="reversing" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Dreamhack-Reversing-Chaining 문제 풀이" /> <meta name="twitter:url" content="http://localhost:4000/blog/paper_study/reversing/chaining" /> <meta name="twitter:description" content="Chaining 문제 풀이" /> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://localhost:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://localhost:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://localhost:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://localhost:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://localhost:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://localhost:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://localhost:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://localhost:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://localhost:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://localhost:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://localhost:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://localhost:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://localhost:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://localhost:4000/assets/js/search.js"></script> <script src="http://localhost:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark nav-down" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">TouBVa</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/contact" >Contact</a > </li> </ul> </div> <ul class="nav justify-content-end"> <!-- <li class="nav-item"> <a class="nav-link" href="http://localhost:4000/styleguide"> Styleguide </a> </li>--> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- <li class="nav-item" style="margin-top:5px; padding-right:20px;" > <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill"></path> </svg> <span class="snipcart-items-count"></span> </a> </li> --> </ul> </nav> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script> <script type="text/javascript"> var didScroll; var lastScrollTop = 0; var delta = 5; var navbarHeight = document.querySelector('#topNav').offsetHeight; window.addEventListener('scroll', function(event) { didScroll = true; }); setInterval(function() { if (didScroll) { hasScrolled(); didScroll = false; } }, 250); function hasScrolled() { var st = window.pageYOffset || document.documentElement.scrollTop; if (Math.abs(lastScrollTop - st) <= delta) return; var nav = document.querySelector('#topNav'); var prog = document.querySelector('#progress-bar'); if (st > lastScrollTop && st > navbarHeight) { nav.classList.remove('nav-down'); nav.classList.add('nav-up'); prog.classList.remove('toDown'); prog.classList.add('toUp'); } else { if (st < lastScrollTop) { nav.classList.remove('nav-up'); nav.classList.add('nav-down'); prog.classList.remove('toUp'); prog.classList.add('toDown'); } } lastScrollTop = st; } </script> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Dreamhack-Reversing-Chaining 문제 풀이</h1> <h4 class="post-meta">Chaining 문제 풀이</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://localhost:4000/blog/authors/TouBVa">TouBVa</a></span> </span > at <time datetime="2023-08-31 13:05:23 +0900" itemprop="datePublished" >Aug 31, 2023</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/paper_study/reversing/chaining" ></span> <div class="post-categories"> Category : <a href="/blog/categories/reversing" >reversing</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top " src="http://localhost:4000/assets/img/posts/chaining/Untitled.png" alt="" style="height: 50%; width: 50%; display: block; margin-left: auto; margin-right: auto;" /> <br /> <br /> <ul id="markdown-toc"> <li><a href="#dreamhack-chaining-문제-풀이" id="markdown-toc-dreamhack-chaining-문제-풀이">Dreamhack Chaining 문제 풀이</a></li> <li><a href="#0-바이너리-포맷-분석" id="markdown-toc-0-바이너리-포맷-분석">0. 바이너리 포맷 분석</a> <ul> <li><a href="#01-파일에-적용된-보호-기법-및-엔트리-확인" id="markdown-toc-01-파일에-적용된-보호-기법-및-엔트리-확인">0.1. 파일에 적용된 보호 기법 및 엔트리 확인</a></li> <li><a href="#02-엔트리의-함수-확인" id="markdown-toc-02-엔트리의-함수-확인">0.2. 엔트리의 함수 확인</a></li> </ul> </li> <li><a href="#1-행위기반-정적-디버깅" id="markdown-toc-1-행위기반-정적-디버깅">1. 행위기반 정적 디버깅</a></li> <li><a href="#2-동적-디버깅" id="markdown-toc-2-동적-디버깅">2. 동적 디버깅</a> <ul> <li><a href="#21-main-이후-실행되는-함수-sub_34d7" id="markdown-toc-21-main-이후-실행되는-함수-sub_34d7">2.1. main 이후 실행되는 함수: sub_34D7</a></li> <li><a href="#22-sub_19c4-내부에서-password-를-출력하는-부분-체크" id="markdown-toc-22-sub_19c4-내부에서-password-를-출력하는-부분-체크">2.2. sub_19C4 내부에서 password: 를 출력하는 부분 체크</a></li> <li><a href="#23-sub_1447-분석" id="markdown-toc-23-sub_1447-분석">2.3. sub_1447 분석</a></li> <li><a href="#24-sub_14ed-분석" id="markdown-toc-24-sub_14ed-분석">2.4. sub_14ed 분석</a></li> <li><a href="#25-sub_15bb-분석" id="markdown-toc-25-sub_15bb-분석">2.5. sub_15bb 분석</a> <ul> <li><a href="#251-sub_1545-for-4k-4k2-elements" id="markdown-toc-251-sub_1545-for-4k-4k2-elements">2.5.1. sub_1545 (for 4k, 4k+2 elements)</a></li> <li><a href="#252-sub_1580-for-4k1-4k3-elements" id="markdown-toc-252-sub_1580-for-4k1-4k3-elements">2.5.2 sub_1580 (for 4k+1, 4k+3 elements)</a></li> </ul> </li> <li><a href="#26-sub_16e0-분석" id="markdown-toc-26-sub_16e0-분석">2.6. sub_16e0 분석</a></li> <li><a href="#27-sub_172e-분석" id="markdown-toc-27-sub_172e-분석">2.7. sub_172e 분석</a></li> <li><a href="#28-sub_193c-분석" id="markdown-toc-28-sub_193c-분석">2.8. sub_193c 분석</a></li> </ul> </li> <li><a href="#3-복호화-프로그램-만들기" id="markdown-toc-3-복호화-프로그램-만들기">3. 복호화 프로그램 만들기</a> <ul> <li><a href="#31-sub_1215-does-xor-every-char-in-user-input-with-0x44" id="markdown-toc-31-sub_1215-does-xor-every-char-in-user-input-with-0x44">3.1. sub_1215: does xor every char in user input with 0x44</a></li> <li><a href="#32-sub_1268-make-a-permutation-table" id="markdown-toc-32-sub_1268-make-a-permutation-table">3.2. sub_1268: make a permutation table</a></li> <li><a href="#33-sub_1447-does-permutation-on-user-inputbuf" id="markdown-toc-33-sub_1447-does-permutation-on-user-inputbuf">3.3. sub_1447: Does Permutation on user input(buf)</a></li> <li><a href="#34-sub_14ed--table의-1-byte를-buf의-1byte와-xor해-buf에-저장한다" id="markdown-toc-34-sub_14ed--table의-1-byte를-buf의-1byte와-xor해-buf에-저장한다">3.4. sub_14ed: table의 1 byte를 buf의 1byte와 xor해 buf에 저장한다.</a></li> <li><a href="#35-sub_15bb-buf에서-4k-4k1-4k2-4k3-k0-1---15-번째의-원소별로-다른-알고리즘을-적용해-변환한다-즉-substitution-연산을-한다" id="markdown-toc-35-sub_15bb-buf에서-4k-4k1-4k2-4k3-k0-1---15-번째의-원소별로-다른-알고리즘을-적용해-변환한다-즉-substitution-연산을-한다">3.5. sub_15bb: buf에서 4k, 4k+1, 4k+2, 4k+3 (k=0, 1, … , 15) 번째의 원소별로 다른 알고리즘을 적용해 변환한다. 즉 substitution 연산을 한다.</a> <ul> <li><a href="#351-sub_1545-우로-n비트-순환-시프트-연산을-수행하는-함수다-for-4k-4k2" id="markdown-toc-351-sub_1545-우로-n비트-순환-시프트-연산을-수행하는-함수다-for-4k-4k2">3.5.1. sub_1545: 우로 n비트 순환 시프트 연산을 수행하는 함수다. (for 4k, 4k+2)</a></li> <li><a href="#352-sub_1580-좌로-n비트-순환-시프트-연산을-수행하는-함수다-for-4k1-4k3" id="markdown-toc-352-sub_1580-좌로-n비트-순환-시프트-연산을-수행하는-함수다-for-4k1-4k3">3.5.2. sub_1580: 좌로 n비트 순환 시프트 연산을 수행하는 함수다. (for 4k+1, 4k+3)</a></li> </ul> </li> <li><a href="#36-sub_16e0-카이사르-치환-암호화" id="markdown-toc-36-sub_16e0-카이사르-치환-암호화">3.6. sub_16e0: 카이사르 치환 암호화</a></li> <li><a href="#37-sub_172e" id="markdown-toc-37-sub_172e">3.7. sub_172e</a></li> <li><a href="#38-sub_193c-여긴-정답-배열과-input-배열을-대조하는-루틴이다" id="markdown-toc-38-sub_193c-여긴-정답-배열과-input-배열을-대조하는-루틴이다">3.8. sub_193c: 여긴 정답 배열과 input 배열을 대조하는 루틴이다.</a></li> </ul> </li> <li><a href="#4-구현-및-결과" id="markdown-toc-4-구현-및-결과">4. 구현 및 결과</a></li> </ul> <h1 id="dreamhack-chaining-문제-풀이">Dreamhack Chaining 문제 풀이</h1> <p>주어진 바이너리를 실행해 보면 아래와 같은 화면이 출력된다.</p> <p><img src="/assets/img/posts/chaining/Untitled.png" alt="Untitled" width="100%" height="100%" /></p> <p>Password로 알맞은 값을 줘야 pass가 뜰 것이고, 그건 플래그값이 될 것이다.</p> <p>일단 바이너리의 data섹션에 저장된 string을 불러오는 부분이 있을 것이고, 해당 스트링을 띄우는 함수 내부에서 input값이 올바른 값인지 체크하는 부분이 있을 것임을 유추할 수 있다.</p> <h1 id="0-바이너리-포맷-분석">0. 바이너리 포맷 분석</h1> <h2 id="01-파일에-적용된-보호-기법-및-엔트리-확인">0.1. 파일에 적용된 보호 기법 및 엔트리 확인</h2> <p><img src="/assets/img/posts/chaining/Untitled%201.png" alt="Untitled" width="100%" height="100%" /></p> <ol> <li>해당 파일에는 모든 보호 조치가 적용되어 있고, PIE(바이너리가 업로드되는 메모리 영역이 매번 달라져서 plt나 got 접근을 통해 라이브러리 함수의 절대 주소를 알아내는 기법을 차단함)및 Full RELRO(got overwrite를 차단함)가 적용되어 있다.</li> <li>또한 Stripped되어 있어 함수나 변수 등의 심볼이 전부 없어져 있다.</li> <li>이런 경우, 함수의 엔트리가 어디인지 알아내야 이후 리버싱이 편하다. readelf로 헤더 정보를 읽어낸 결과, 엔트리 오프셋은 <code class="language-plaintext highlighter-rouge">0x10a0</code>임을 확인했다.</li> </ol> <h2 id="02-엔트리의-함수-확인">0.2. 엔트리의 함수 확인</h2> <p>IDA를 사용해 엔트리에 어떤 함수가 정의되어 있는지 확인한다.</p> <p><img src="/assets/img/posts/chaining/Untitled%202.png" alt="Untitled" width="100%" height="100%" /></p> <p>start로 정의되어 있고, 내부에서 libc_start_main을 콜함을 확인했다. 이 함수의 첫 번째 인자인 rdi에 들어간 주소가 main함수의 주소이므로, main을 찾아낼 수 있었다.</p> <p><img src="/assets/img/posts/chaining/Untitled%203.png" alt="Untitled" width="100%" height="100%" /></p> <p>main의 내부에서는 sub_34D7을 콜함을 확인했다.</p> <p>그런데 조금 이상하다. <code class="language-plaintext highlighter-rouge">sub_34D7(rbp+var_18, rbp+var_10), var_18과 var_10은 모두 특정 ptr과 관련 있음</code>은 대체 무슨 뜻인지 모르겠기 때문이다… 심지어 저 ptr이 뭔지도 알 수 없다. 따라서 gdb를 붙여서 직접 어떤 인자가 들어가는지 확인해 보려 한다.</p> <p><img src="/assets/img/posts/chaining/Untitled%204.png" alt="Untitled" width="100%" height="100%" /></p> <p>일단 엔트리 상에서 메인함수를 콜하는 부분을 찾았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%205.png" alt="Untitled" width="100%" height="100%" /></p> <p>그리고 메인함수를 보니 IDA로 찾았던 메인함수의 인스트럭션과 일치함을 확인할 수 있었다.</p> <p>아하! IDA에서 보였던 ptr 변수는 main 스택프레임의 rbp였다. 해당 바이너리가 stripped되었기 때문에 생긴 현상으로 보인다.</p> <h1 id="1-행위기반-정적-디버깅">1. 행위기반 정적 디버깅</h1> <p>일단 여기까지 하고, 앞서 추측했던 점-내부에 저장된 문자열이 출력되는 함수와 사용자 입력값 verification 부분이 밀접할 것이라는 점-이 맞는지 확인해 보기로 했다.</p> <p><img src="/assets/img/posts/chaining/Untitled%206.png" alt="Untitled" width="100%" height="100%" /></p> <p>아마 good:) 부분이 올바른 코드 플로우겠지</p> <p><img src="/assets/img/posts/chaining/Untitled%207.png" alt="Untitled" width="100%" height="100%" /></p> <p>xref lookup을 이용해 해당 문자열을 참조하는 코드섹션으로 이동했다.</p> <p><img src="/assets/img/posts/chaining/Untitled%208.png" alt="Untitled" width="100%" height="100%" /></p> <p>해당 문자열을 출력하는 기능을 발견했고, 함수가 정의되어 있지 않아 함수로 정의해 주었다.</p> <p>여기에서부터 문제를 푸는 방법을 고려해 보았으나, 다 stripped되어 있으므로 역으로 따라가는 것은 힘들어 보인다. 따라서 <code class="language-plaintext highlighter-rouge">password:</code> 를 출력하는 부분부터 순차적으로 따라가 보기로 했다.</p> <p><code class="language-plaintext highlighter-rouge">sub_19C4</code>에서 시작하는 함수에서 <code class="language-plaintext highlighter-rouge">password:</code> 문자열을 참조하고 있음을 확인했지만, 정작 프린트하는 함수는 없어 보인다.</p> <p>애초에 해당 함수는 굉장히 이상해 보이는데, 이유는 아래와 같다.</p> <p>첫째, 분명히 <code class="language-plaintext highlighter-rouge">password:</code> 문자열을 가져와 사용하는데 이걸 pseudo-function으로 바꿔 보면 그런 부분이 전혀 보이지 않는다. 즉 IDA가 인지할 수 없는 형태로 코드가 짜여져 있다.</p> <p><img src="/assets/img/posts/chaining/Untitled%209.png" alt="Untitled" width="100%" height="100%" /></p> <p>둘째, 이전의 문자열 출력 함수들에서 주로 보였던 puts 등의 출력 함수를 콜하는 부분이 보이지 않는다. 실제로 pwndbg의 rop를 이용해 찾은 call 가젯 중 오프셋 <code class="language-plaintext highlighter-rouge">0x193C</code>이상 <code class="language-plaintext highlighter-rouge">0x34CE</code> (0x00005555555559C4~0x00005555555574CE) 범위에 해당되는 것은 없었다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2010.png" alt="Untitled" width="100%" height="100%" /></p> <p>셋째. 그렇다면 상기 조건을 모두 충족할 때, 여기에서 syscall write on console이 가능한 이유는 뭘까? 사실 당장은 모르겠다.</p> <p>일단 접근법을 결정해 보자. 현재 목표는 <code class="language-plaintext highlighter-rouge">good:)</code>를 출력하기 전에, 사용자 입력값 verification 과정을 찾아내는 것이다. 이를 위해 역순으로 접근했으나 함수 간의 연결성이 확보되지 않아 스트링을 근거로 <code class="language-plaintext highlighter-rouge">password:</code> 를 출력하는 부분부터 찾아 이후 함수의 행위를 확인함으로써 함수 간의 연결성을 확보하려는 시도 중이다.</p> <p>이를 위해 첫째, syscall이 수행되기 위해 필수적인 가젯을 찾아본다. 둘째, 동적으로 디버깅하며 syscall write가 수행되는 지점에 bp를 건다. 두 가지 접근이 가능하다.</p> <p>단, 현재 문제를 푸는 과정이므로 두 번째 방식으로 접근해 빠르게 <code class="language-plaintext highlighter-rouge">password:</code>를 출력하는 부분을 찾고 이후 어떤 함수가 실행되는지 체크해야 한다.</p> <h1 id="2-동적-디버깅">2. 동적 디버깅</h1> <h2 id="21-main-이후-실행되는-함수-sub_34d7">2.1. main 이후 실행되는 함수: sub_34D7</h2> <p><img src="/assets/img/posts/chaining/Untitled%2011.png" alt="Untitled" width="100%" height="100%" /></p> <p>일단 앞에서 찾았던 지점을 정리하고 <code class="language-plaintext highlighter-rouge">password:</code>를 출력하는 부분을 찾자.</p> <p>IDA에서 sub_34D7을 콜하는 지점으로 확인됐던 지점에 bp를 걸고 실행해 보았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2012.png" alt="Untitled" width="100%" height="100%" /></p> <p>저거 너무 string같은 포맷인데… 실제로 확인해 보니 스트링이 맞다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2013.png" alt="Untitled" width="100%" height="100%" /></p> <p>저런 문자열을 보통 받는 함수가 있나? 그건 이후 찾아봐야 할 문제 같다.</p> <p>일단 <code class="language-plaintext highlighter-rouge">sub_34D7(”\177ELF\002\001\001\003”, “\177ELF\002\001\001”)</code> 인 점은 체크해두자.</p> <p><img src="/assets/img/posts/chaining/Untitled%2014.png" alt="Untitled" width="100%" height="100%" /></p> <p>이후 <code class="language-plaintext highlighter-rouge">sub_19C4(”\177ELF\002\001\001\003”, “\177ELF\002\001\001”)</code> 를 한다.</p> <h2 id="22-sub_19c4-내부에서-password-를-출력하는-부분-체크">2.2. sub_19C4 내부에서 password: 를 출력하는 부분 체크</h2> <p>pwndbg 내부에는 특정 시스콜이 실행될 때 코드플로우를 멈춰 주는 기능이 있다.</p> <p>따라서 <code class="language-plaintext highlighter-rouge">catch syscall write</code> 옵션을 주고 프로그램을 실행시켜 보았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2015.png" alt="Untitled" width="100%" height="100%" /></p> <p>전혀 상관 없는 함수 내부의 syscall 인스트럭션을 실행하는 부분에서 멈췄다. 현재 rsi에 <code class="language-plaintext highlighter-rouge">input</code> 이 들어가 있고, 아래 스택에 <code class="language-plaintext highlighter-rouge">password:</code> 가 들어가 있는 것을 보아 실제로 <code class="language-plaintext highlighter-rouge">input password:</code> 를 콘솔에 뿌려 주는 부분인 것이 맞는 것 같다.</p> <p>여기에서 rip가 멈춰 있는 함수는 vmmap으로 확인한 결과 기본 라이브러리 함수였다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2016.png" alt="Untitled" width="100%" height="100%" /></p> <p>아하! 그럼 주어진 바이너리는 rop를 이용해 만든 바이너리임을 추측할 수 있다. 원래 바이너리의 코드부가 아닌 멀쩡한 라이브러리 함수의 코드부에서도 특정 목적을 위한 인스트럭션으로 점프한 것을 그 근거로 들 수 있다. 또한 콜스택에 유의미한 콜러-콜리 정보가 없는 대신 스택에 가젯들이 들어가 있는 것을 그 그 근거로 들 수 있겠다.</p> <p>그럼 이제 해당 행위가 끝나고 리턴할 지점은 콜스택이 아니라 프로세스 스택에 저장되어 있을 것이다. 즉 pwndbg가 제공하는 backtrace로는 리턴할 callee를 찾아낼 수 없다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2017.png" alt="Untitled" width="100%" height="100%" /></p> <p>따라서 스택을 분석해 보았다. 그 결과 알아낸 점은 아래와 같다.</p> <ol> <li>사이에 2개 값들이 용처가 정확하지 않게 비어 있다. 이것들이 어떻게 되는지는 쭉 따라가면서 찾아봐야 할 텐데, 중간의 0xbeefbeefbeefbeef는 누가 봐도 바이너리에서 넣어 준 값 같다. 매우 특징적인 값이므로 따라가볼 만하다고 생각한다. <ul> <li> <p>찾아보니, 정말로 바이너리에 있었다. 오프셋 <code class="language-plaintext highlighter-rouge">0x202e</code>에서 진행되는 행위였다.</p> <p>해당 지점은 스택에 rop chain을 저장하는 기능에 포함되어 있었다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2018.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> </li> <li>사용자 입력값을 저장하는 버퍼로 0x55555555a800를 사용하고 있다. 디버거상에서 해당 메모리를 참조할 때마다 멈추도록 설정한 다음 프로그램을 돌리면 어떤 행위가 일어나는지, 그리고 그 행위는 어떤 함수에서 수행되는지 알 수 있을 것 같다. <ul> <li> <p>행위 분석 및 함수 복원</p> <p><img src="/assets/img/posts/chaining/Untitled%2019.png" alt="Untitled" width="100%" height="100%" /></p> <p><img src="/assets/img/posts/chaining/Untitled%2020.png" alt="Untitled" width="100%" height="100%" /></p> <p>bp가 트리거되었을 때 컨텍스트. 앞선 read/write를 끝내고 오프셋 0x1215로 돌아와 다른 행위를 하는데, 사용자 입력값이 저장된 버퍼에 어떤 행위를 했다.</p> <p>어떤 행위를 했는지 IDA로 확인해 보니, 아래와 같았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2021.png" alt="Untitled" width="100%" height="100%" /></p> <p>사용자 입력값이 저장된 버퍼에 rax의 하위 32비트(al)을 저장했다.</p> <p>해당 기능은 IDA기준 <code class="language-plaintext highlighter-rouge">sub_1215</code> 함수의 일부로 정의되어 있다. 해당 함수를 가상코드로 변환해 보면 영 이상하다. 어셈블리와 비교하며 올바른 루프문으로 바꿔주면 아래와 같다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2022.png" alt="Untitled" width="100%" height="100%" /></p> <p>반복할 횟수를 a1으로 받아(아마 문자열의 길이일 것이고, 앞에서 봤던 스택을 생각하면 0x40일 것이다), 사용자 입력이 저장된 버퍼에 대해 a3와 xor연산을 한다. a3는 전달받을 당시 edx로 전달되며 이후 버퍼에 저장된 첫 글자부터 xor되는 int값이다. 앞에서 봤던 스택과, 동적으로 디버깅했을 때 0x41과 xor된 값이 0x5라는 점을 감안하면 0x44가 인자로 주어지는 것 같다. 따라서 <code class="language-plaintext highlighter-rouge">sub_1215</code>를 복원하면 아래와 같다.</p> <p><code class="language-plaintext highlighter-rouge">sub_1215(0x40, char *buf, 0x44)</code>: does xor every chars in user input with 0x44</p> </li> </ul> </li> <li>또한 해당 바이너리의 코드 영역에 해당하는 주소가 중간에 2개 존재하는데, 이는 특정 행위를 마치고 코드 플로우가 돌아갈 부분을 의미하는 것 같다. 실제로 동적으로 디버깅해 보니 <code class="language-plaintext highlighter-rouge">0x1215</code> 이후 <code class="language-plaintext highlighter-rouge">0x1268</code>이 실행됨을 확인할 수 있었다. 두 주소를 IDA에서 확인해 보니 아래와 같았다. <ul> <li> <p>0x1215 함수는 이미 복원했으므로 0x1268만 다루겠다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2023.png" alt="0x1268의 루틴" width="100%" height="100%" /></p> <p>0x1268의 루틴</p> </li> </ul> <p><img src="/assets/img/posts/chaining/Untitled%2024.png" alt="0x1268의 pseudo-code" width="100%" height="100%" /></p> <p>0x1268의 pseudo-code</p> <p>해당 함수가 실행되는 순간의 레지스터는 아래와 같았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2025.png" alt="Untitled" width="100%" height="100%" /></p> <p>즉 <code class="language-plaintext highlighter-rouge">0x1268(0xe5119cf0, 0xddc615f0, 0x7851327a, 0x84a7815a, char *buf)</code>이다.</p> <p>그렇다면 이 함수는 어떤 기능을 할까? 일단 사용자 인풋이 저장되는 주소인 <code class="language-plaintext highlighter-rouge">0x55555555a800</code> 과는 아무런 상호작용이 없다는 점에서 입력과는 독립적인 무언가를 행하는 부분일 것이다.</p> <p>아마 느낌상 <code class="language-plaintext highlighter-rouge">0x55555555a900</code>이 모종의 단계를 거쳐 변화한 값이 저장되는 부분일 것이고…</p> <p><img src="/assets/img/posts/chaining/Untitled%2026.png" alt="Untitled" width="100%" height="100%" /></p> <p>그리고 실제로도 맞는 것 같다. 그럼 대체 뭘 변화시킨 걸까?</p> <p>사실 감이 안 온다. 그럼 일단 넘어가고, 다음에 실행되는 함수를 분석해 보자.</p> <p>해당 함수를 총 3회 정도 추가로 수행하고 다음 함수로 넘어감을 확인했다. 그 때의 <code class="language-plaintext highlighter-rouge">0x55555555a900</code> 은 다음과 같았다. (참고: 어떤 함수를 몇 번 수행할지는 스택을 보면 알 수 있다. ROP chaining을 통해 이미 스택에 코드 플로우가 다 들어가 있기 때문이다. 따라서 동적 디버깅을 할 때 왜 똑같은 함수로 들어가는 거지? 싶으면 스택을 보면 된다.)</p> <p><img src="/assets/img/posts/chaining/Untitled%2027.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ol> <h2 id="23-sub_1447-분석">2.3. sub_1447 분석</h2> <p>현재까지의 흐름은 아래와 같다..</p> <p><code class="language-plaintext highlighter-rouge">main</code> → <code class="language-plaintext highlighter-rouge">sub_34d7</code> → <code class="language-plaintext highlighter-rouge">sub_19c4</code>(rop chaining) → <code class="language-plaintext highlighter-rouge">sub_1215</code> → <code class="language-plaintext highlighter-rouge">sub_1268</code> * 4</p> <p>이후 실행되는 함수는 <code class="language-plaintext highlighter-rouge">sub_1447</code>이었다. 해당 함수의 기능을 알아보자.</p> <p>IDA 상에서는 함수로 인식되지 않기 때문에, 내가 직접 함수로 설정해줘야 한다. create function 기능을 이용해 함수로 만들어 주었다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2028.png" alt="Untitled" width="100%" height="100%" /></p> <p>해당 함수는 두 개의 인자를 받는데, 첫 번째가 user input이 저장된 부분이고 두 번째가 <code class="language-plaintext highlighter-rouge">sub_1268</code>에서 만들어준 값이 저장된 부분이다. 여기에서 user input이 변화할 것임을 추측할 수 있다.</p> <p>또한 우리는 <code class="language-plaintext highlighter-rouge">sub_1268</code>에서 모종의 값을 변화해 저장하면서 16바이트의 공간에 16회 접근한 것을 알고 있다. 즉, 1바이트를 배열의 한 인덱스에 저장되는 값으로 취급했음을 알고 있다. 이를 기반으로 IDA에서 출력해 주는 가상함수를 수정하면 아래와 같다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2029.png" alt="Untitled" width="100%" height="100%" /></p> <p>아하… sub_1268에서 만들어준 값 배열은 위치 지정자였음을 알 수 있다. 일종의 테이블 아닐까? SPN 네트워크 구조에서 보이는 Permutation 구조를 반영한 것 말이다. 즉 user input 내부의 순서를 마구 바꿔서 다시 user input에 저장하는… 그런 것 같다.</p> <p>따라서 나는 <code class="language-plaintext highlighter-rouge">sub_1447</code>을 <code class="language-plaintext highlighter-rouge">after_password_3_Permutation_sub_1447</code>로 네이밍했고, <code class="language-plaintext highlighter-rouge">sub_1268</code>을 <code class="language-plaintext highlighter-rouge">after_password_2_making_permutation_table_sub_1268</code>로 네이밍했다.</p> <p>sub_1447을 복원하면 아래와 같다.</p> <p><code class="language-plaintext highlighter-rouge">sub_1447(char *buf, int8 *table)</code>: Does Permutation on user input(buf)</p> <p>이제 다른 함수로 넘어가 보자. 그 전에, 이 함수를 총 몇 회 수행하는지 체크했다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2030.png" alt="Untitled" width="100%" height="100%" /></p> <p>총 4회 수행한다. (usr_input의 0~15, 16~31, 32~47, 48~63 인덱스에 대해 차례로 table의 첫 바이트부터 참고하여 permutation을 수행하는 것이라 어느 쪽으로 옮겨진 게 또 다른 쪽으로 옮겨질 수도 있다.)</p> <h2 id="24-sub_14ed-분석">2.4. sub_14ed 분석</h2> <p>현재까지의 흐름은 아래와 같다</p> <p><code class="language-plaintext highlighter-rouge">main</code> → <code class="language-plaintext highlighter-rouge">sub_34d7</code> → <code class="language-plaintext highlighter-rouge">sub_19c4</code>(rop chaining) → <code class="language-plaintext highlighter-rouge">sub_1215</code> → <code class="language-plaintext highlighter-rouge">sub_1268</code> * 4 → <code class="language-plaintext highlighter-rouge">sub_1447</code> *4</p> <p>이쯤에서 사용자 input은 어떻게 됐는지 보자. 아 그런데 나는 입력값을 알파벳 하나로 통일해서… permutation이 안 잡힐 것 같긴 하다….</p> <p><img src="/assets/img/posts/chaining/Untitled%2031.png" alt="Untitled" width="100%" height="100%" /></p> <p>그리고 역시 안 잡혔다. 하지만 permutation이 진행된 것이다…!!!!!!</p> <p>음 입력값의 permutation이 더 확실히 잡히는 게 나을 것 같아 다른 값을 주고 재실행했다.</p> <p>입력값: 0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@!</p> <p>sub_1447(permutation) 수행 전</p> <p><img src="/assets/img/posts/chaining/Untitled%2032.png" alt="Untitled" width="100%" height="100%" /></p> <p>sub_1447(permutation) 수행 마무리 후</p> <p><img src="/assets/img/posts/chaining/Untitled%2033.png" alt="Untitled" width="100%" height="100%" /></p> <p>IDA에서는 sub_14ed 또한 함수로 인식하지 못하므로 create function 해줬다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2034.png" alt="Untitled" width="100%" height="100%" /></p> <p>여기에서 전달되는 두 개의 인자는 무엇인지 확인해 보았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2035.png" alt="Untitled" width="100%" height="100%" /></p> <p>rsi로는 user input buffer의 시작주소가 들어가 있는 것을 확인했다.</p> <p>rdi에는 이전까지 보지 못했던 주소가 들어가 있다. 해당 주소에 뭐가 있는지 확인해 보니 아래와 같았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2036.png" alt="Untitled" width="100%" height="100%" /></p> <p>user input에 영향을 받는 부분일까? 알고 싶어 다시 한 개 알파벳으로만 통일한 값을 줘 보았으나, 변동은 없었다. 이것도 모종의 테이블 같다. (0xa060은 오프셋 0x6060으로 정답값이 들어있는 64바이트 배열이다)</p> <p><img src="/assets/img/posts/chaining/Untitled%2037.png" alt="Untitled" width="100%" height="100%" /></p> <p>어셈블리에서 1바이트 단위로 테이블에서 값을 가져와 xor 연산을 하고 있다는 점을 감안해 IDA의 가상함수를 수정하니 아래와 같았다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2038.png" alt="Untitled" width="100%" height="100%" /></p> <p>또 xor이다!</p> <p>즉 sub_14ed를 복원하면 아래와 같았다.</p> <p><code class="language-plaintext highlighter-rouge">sub_14ed(char *table, char *buf)</code> : table의 1 byte를 buf의 1byte와 xor해 buf에 저장한다.</p> <h2 id="25-sub_15bb-분석">2.5. sub_15bb 분석</h2> <p>혹시나 해서 다시 언급한다. 이 문제는 stack-based rop chaining으로, 다음에 무슨 함수가 실행될지는 스택을 쭉 펼쳐보면 알 수 있다. 동적으로 디버깅하는 코드 플로우와 스택을 비교해 가면서 지금 내가 맞는 위치에 있는지 꼭 확인하자!</p> <p><img src="/assets/img/posts/chaining/Untitled%2039.png" alt="Untitled" width="100%" height="100%" /></p> <p>어셈블리까지 감안해 보았을 때, 해당 함수에 전달되는 파라미터는 하나로, user input이 저장된 buf의 시작주소인 것 같다.</p> <p>그리고 가상코드로 변환한 IDA의 코드를 보면 다음과 같다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2040.png" alt="Untitled" width="100%" height="100%" /></p> <p>buf에서 4k, 4k+1, 4k+2, 4k+3 (k=0, 1, … , 15) 번째의 원소별로 다른 알고리즘을 적용해 변환한다. 즉 substitution 연산을 한다.</p> <p>이제 callee들을 분석해 보자.</p> <h3 id="251-sub_1545-for-4k-4k2-elements">2.5.1. sub_1545 (for 4k, 4k+2 elements)</h3> <p>전달되는 인자들의 type을 감안해 해당 함수에서 사용되는 파라미터들의 type을 수정해 주었다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2041.png" alt="Untitled" width="100%" height="100%" /></p> <p>숫자 8을 기준으로 대칭이 되는 pair로 좌, 우에 대해 각각 시프트 연산을 한다는 의미는 다음과 같다.</p> <ol> <li> <p>시프트 연산 대상의 자료형이 8bits 크기를 가진다.</p> <p>→ 즉, 이 크기를 넘어가게 시프트를 시켜버리면 데이터가 완전히 소실된다.</p> </li> <li> <p>좌, 우에 대해 각각 x, y 비트만큼을 시프트시킬 때 x+y=8이고, 그 둘을 or 연산 한다.</p> <p>→ or 연산의 의미는 데이터를 최대한 보존하겠다는 것이다.</p> <p>→ 이는 좌로 x비트 순환 시프트 연산(==우로 y비트 순환 시프트 연산)을 시키겠다는 뜻이다.</p> </li> <li> <p>결론: 해당 함수는 우로 a2비트 순환 시프트 연산을 수행하는 함수다.</p> </li> </ol> <h3 id="252-sub_1580-for-4k1-4k3-elements">2.5.2 sub_1580 (for 4k+1, 4k+3 elements)</h3> <p><img src="/assets/img/posts/chaining/Untitled%2042.png" alt="Untitled" width="100%" height="100%" /></p> <p>좌로 a2비트 순환 시프트 연산을 수행하는 함수다.</p> <p>이제 분석이 끝났으니, 해당 함수의 끝에 bp를 걸고 다음 함수로 넘어가 보자.</p> <h2 id="26-sub_16e0-분석">2.6. sub_16e0 분석</h2> <p><img src="/assets/img/posts/chaining/Untitled%2043.png" alt="Untitled" width="100%" height="100%" /></p> <p>여기에서 IDA로 뺀 가상함수는 알아보기 힘들기 때문에 참고해서 재구성해야 한다.</p> <p>해당 함수에 진입하기 전에 수행된 함수가 epilogue를 수행한 직후의 스택을 확인하자(stack-based rop chaining이므로 전달되는 파라미터가 const인지 확인하려면 스택을 봐야 한다)</p> <p><img src="/assets/img/posts/chaining/Untitled%2044.png" alt="Untitled" width="100%" height="100%" /></p> <p>pop rsi를 통해 함수의 두 번째 인자로 전달될 값이 무조건 고정임을 확인했다. (offset이 0x0011이고, 이후 이것의 하위 1바이트를 사용하므로)</p> <p>또한 어셈블리를 보고 함수를 재구성한 결과 복원된 함수는 아래와 같음을 확인했다.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sub_16e0</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="c1">// x==0x11</span>
<span class="p">{</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">63</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mh">0x11</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>즉 카이사르 치환 암호화를 적용했다.</p> <h2 id="27-sub_172e-분석">2.7. sub_172e 분석</h2> <p>그 다음에 실행되는 함수는 sub_172e였다. 해당 함수 프롤로그 실행될 당시의 context를 보자.</p> <p><img src="/assets/img/posts/chaining/Untitled%2045.png" alt="Untitled" width="100%" height="100%" /></p> <p>어셈블리로부터 인자가 단 하나만 들어갔고, 그 인자는 user_input의 시작 주소임을 알 수 있다.</p> <p>이제 IDA로 디스어셈블한 코드를 보자.</p> <p><img src="/assets/img/posts/chaining/Untitled%2046.png" alt="Untitled" width="100%" height="100%" /></p> <p>굳이 더 부연하지 않고 넘어가야겠다. 중요한 건 이걸 복호화하는 코드를 만드는 일이고, 그를 위해서는 해당 연산에 xor만이 사용되었다, 즉 xor로 간단히 복호화 가능하다는 점만이 중요하기 때문이다.</p> <h2 id="28-sub_193c-분석">2.8. sub_193c 분석</h2> <p>여기는 사용자의 입력이 정답이 아닐 경우 nop :( 를 출력해 주는 함수다. 해당 함수가 수행되기 직전의 스택 상태를 보면 다음과 같다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2047.png" alt="Untitled" width="100%" height="100%" /></p> <p>그리고 sub_193c의 내용은 다음과 같다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2048.png" alt="Untitled" width="100%" height="100%" /></p> <p>스택에 sub_193c가 먼저 나와 있고, sub_19a3이 다음으로 나와 있는 것, 그리고 후자에서 good:) 를 출력해 주는 것을 감안하면 저 if 문 안으로 들어가지 않고 return 되었을 때 good:) 가 출력될 것을 추측할 수 있다.</p> <p>즉, byte_6060이 진짜 정답이 들어 있는 배열일 것이고, 64 바이트일 것이다.</p> <p>해당 배열의 내용은 다음과 같다.</p> <p><img src="/assets/img/posts/chaining/Untitled%2049.png" alt="Untitled" width="100%" height="100%" /></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">27</span> <span class="mi">63</span> <span class="mi">72</span> <span class="mi">73</span> <span class="mi">43</span> <span class="mi">3</span><span class="n">F</span> <span class="mi">9</span><span class="n">F</span> <span class="mi">43</span> <span class="mi">2</span><span class="n">E</span> <span class="n">F0</span> <span class="mi">33</span> <span class="n">F3</span> <span class="mi">1</span><span class="n">E</span> <span class="mo">07</span> <span class="mi">0</span><span class="n">A</span> <span class="mi">33</span> <span class="n">E5</span> <span class="mi">6</span><span class="n">C</span> <span class="n">DB</span> <span class="mi">5</span><span class="n">F</span> <span class="n">C9</span> <span class="mi">11</span> <span class="n">DE</span> <span class="mi">62</span> <span class="mi">42</span> <span class="mi">18</span> <span class="n">FE</span> <span class="mi">9</span><span class="n">B</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">15</span> <span class="mi">3</span><span class="n">A</span> <span class="n">BB</span> <span class="mi">96</span> <span class="n">DB</span> <span class="mi">9</span><span class="n">E</span> <span class="mi">23</span> <span class="n">FD</span> <span class="mi">90</span> <span class="mi">10</span> <span class="mi">9</span><span class="n">B</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">0</span><span class="n">A</span> <span class="mi">89</span> <span class="mi">47</span> <span class="n">BD</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">88</span> <span class="n">D6</span> <span class="n">F9</span> <span class="n">B9</span> <span class="mi">50</span> <span class="mi">76</span> <span class="n">E1</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">4</span><span class="n">F</span> <span class="mi">89</span> <span class="mi">54</span> <span class="mi">9</span><span class="n">D</span> <span class="n">B1</span> <span class="n">F1</span> <span class="n">A6</span> <span class="mi">9</span><span class="n">B</span> <span class="mi">8</span><span class="n">A</span> <span class="mi">2</span><span class="n">C</span>
</code></pre></div></div> <p>그럼 이제 절반 왔다! 우리는 사용자의 입력값이 어떤 변환 과정을 거치는지 알고, 그 변환 결과가 어떤 값이 되어야 하는지도 알고 있다. 그럼 이제 복호화 프로그램을 만들어 보자.</p> <h1 id="3-복호화-프로그램-만들기">3. 복호화 프로그램 만들기</h1> <p>앞선 과정을 다시 정리해 보자.</p> <h2 id="31-sub_1215-does-xor-every-char-in-user-input-with-0x44">3.1. sub_1215: does xor every char in user input with 0x44</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_1215(0x40, char *buf, 0x44)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2022.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> <h2 id="32-sub_1268-make-a-permutation-table">3.2. sub_1268: make a permutation table</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_1268(0xe5119cf0, 0xddc615f0, 0x7851327a, 0x84a7815a, char *buf)</code></p> <p>table: (명령어: dump memory ./permutation_table.txt 0x55555555a900 0x55555555a940)</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="mo">07</span> <span class="mi">09</span> <span class="mi">0</span><span class="n">E</span> <span class="mo">01</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">08</span> <span class="mo">03</span> <span class="mo">06</span> <span class="mo">04</span> <span class="mi">0</span><span class="n">A</span> <span class="mo">02</span> <span class="mi">0</span><span class="n">B</span> <span class="mo">00</span> <span class="mo">05</span> <span class="mi">0</span><span class="n">F</span> <span class="mi">0</span><span class="n">D</span> <span class="mo">03</span> <span class="mo">01</span> <span class="mo">04</span> <span class="mi">0</span><span class="n">A</span> <span class="mo">02</span> <span class="mo">06</span> <span class="mi">0</span><span class="n">B</span> <span class="mi">08</span> <span class="mi">0</span><span class="n">F</span> <span class="mi">09</span> <span class="mi">0</span><span class="n">C</span> <span class="mo">05</span> <span class="mi">0</span><span class="n">E</span> <span class="mo">00</span> <span class="mi">0</span><span class="n">D</span> <span class="mo">07</span> <span class="mi">0</span><span class="n">A</span> <span class="mi">0</span><span class="n">E</span> <span class="mi">0</span><span class="n">D</span> <span class="mo">04</span> <span class="mo">05</span> <span class="mo">06</span> <span class="mi">08</span> <span class="mo">03</span> <span class="mi">0</span><span class="n">B</span> <span class="mi">0</span><span class="n">F</span> <span class="mi">09</span> <span class="mo">01</span> <span class="mi">0</span><span class="n">C</span> <span class="mo">02</span> <span class="mo">07</span> <span class="mo">00</span> <span class="mo">07</span> <span class="mo">01</span> <span class="mi">09</span> <span class="mi">0</span><span class="n">A</span> <span class="mo">05</span> <span class="mo">06</span> <span class="mi">0</span><span class="n">F</span> <span class="mo">03</span> <span class="mi">0</span><span class="n">D</span> <span class="mo">02</span> <span class="mi">0</span><span class="n">E</span> <span class="mo">00</span> <span class="mo">04</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">08</span> <span class="mi">0</span><span class="n">B</span>
</code></pre></div> </div> </li> </ul> <h2 id="33-sub_1447-does-permutation-on-user-inputbuf">3.3. sub_1447: Does Permutation on user input(buf)</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_1447(char *buf, int8 *table)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2029.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> <h2 id="34-sub_14ed--table의-1-byte를-buf의-1byte와-xor해-buf에-저장한다">3.4. sub_14ed: table의 1 byte를 buf의 1byte와 xor해 buf에 저장한다.</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_14ed(char *table2, char *buf)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2038.png" alt="Untitled" width="100%" height="100%" /></p> <p>사용된 테이블:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">E9</span> <span class="mi">10</span> <span class="mi">8</span><span class="n">A</span> <span class="mi">6</span><span class="n">D</span> <span class="mi">2</span><span class="n">D</span> <span class="mi">6</span><span class="n">C</span> <span class="mi">45</span> <span class="mi">61</span> <span class="mi">0</span><span class="n">C</span> <span class="n">F6</span> <span class="mi">21</span> <span class="mi">47</span> <span class="mi">15</span> <span class="mi">0</span><span class="n">E</span> <span class="n">C8</span> <span class="mi">25</span> <span class="mi">9</span><span class="n">A</span> <span class="n">E5</span> <span class="n">CA</span> <span class="mi">53</span> <span class="mi">18</span> <span class="mo">07</span> <span class="n">F4</span> <span class="n">C3</span> <span class="n">FB</span> <span class="mi">4</span><span class="n">C</span> <span class="n">AC</span> <span class="mi">34</span> <span class="mi">31</span> <span class="mi">38</span> <span class="n">D3</span> <span class="mi">0</span><span class="n">A</span> <span class="n">D5</span> <span class="mi">22</span> <span class="mi">0</span><span class="n">B</span> <span class="n">C4</span> <span class="n">F5</span> <span class="n">F8</span> <span class="mi">19</span> <span class="n">ED</span> <span class="n">D0</span> <span class="mi">42</span> <span class="n">F2</span> <span class="n">BE</span> <span class="n">F8</span> <span class="mi">4</span><span class="n">A</span> <span class="mi">0</span><span class="n">B</span> <span class="mi">37</span> <span class="n">B4</span> <span class="mi">68</span> <span class="mi">58</span> <span class="mi">92</span> <span class="n">BB</span> <span class="mi">47</span> <span class="n">E6</span> <span class="n">A5</span> <span class="mi">4</span><span class="n">C</span> <span class="mi">21</span> <span class="mi">4</span><span class="n">D</span> <span class="n">EC</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">7</span><span class="n">A</span> <span class="n">FA</span> <span class="mi">2</span><span class="n">F</span>
</code></pre></div> </div> </li> </ul> <h2 id="35-sub_15bb-buf에서-4k-4k1-4k2-4k3-k0-1---15-번째의-원소별로-다른-알고리즘을-적용해-변환한다-즉-substitution-연산을-한다">3.5. sub_15bb: buf에서 4k, 4k+1, 4k+2, 4k+3 (k=0, 1, … , 15) 번째의 원소별로 다른 알고리즘을 적용해 변환한다. 즉 substitution 연산을 한다.</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_15bb(char *buf)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2040.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> <h3 id="351-sub_1545-우로-n비트-순환-시프트-연산을-수행하는-함수다-for-4k-4k2">3.5.1. sub_1545: 우로 n비트 순환 시프트 연산을 수행하는 함수다. (for 4k, 4k+2)</h3> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_1545(char c, int n)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2041.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> <h3 id="352-sub_1580-좌로-n비트-순환-시프트-연산을-수행하는-함수다-for-4k1-4k3">3.5.2. sub_1580: 좌로 n비트 순환 시프트 연산을 수행하는 함수다. (for 4k+1, 4k+3)</h3> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_1580(char c, int n)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2050.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> <h2 id="36-sub_16e0-카이사르-치환-암호화">3.6. sub_16e0: 카이사르 치환 암호화</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_16e0(char *buf, const int x(0x11))</code></p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">sub_16e0</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="c1">// x==0x11</span>
  <span class="p">{</span>
  	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">63</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
  	<span class="p">{</span>
  		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mh">0x11</span>
  	<span class="p">}</span>
  <span class="p">}</span>
</code></pre></div> </div> </li> </ul> <h2 id="37-sub_172e">3.7. sub_172e</h2> <ul> <li> <p><code class="language-plaintext highlighter-rouge">sub_172e(char *buf)</code></p> <p><img src="/assets/img/posts/chaining/Untitled%2046.png" alt="Untitled" width="100%" height="100%" /></p> </li> </ul> <h2 id="38-sub_193c-여긴-정답-배열과-input-배열을-대조하는-루틴이다">3.8. sub_193c: 여긴 정답 배열과 input 배열을 대조하는 루틴이다.</h2> <ul> <li> <p>정답 배열</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="mi">27</span> <span class="mi">63</span> <span class="mi">72</span> <span class="mi">73</span> <span class="mi">43</span> <span class="mi">3</span><span class="n">F</span> <span class="mi">9</span><span class="n">F</span> <span class="mi">43</span> <span class="mi">2</span><span class="n">E</span> <span class="n">F0</span> <span class="mi">33</span> <span class="n">F3</span> <span class="mi">1</span><span class="n">E</span> <span class="mo">07</span> <span class="mi">0</span><span class="n">A</span> <span class="mi">33</span> <span class="n">E5</span> <span class="mi">6</span><span class="n">C</span> <span class="n">DB</span> <span class="mi">5</span><span class="n">F</span> <span class="n">C9</span> <span class="mi">11</span> <span class="n">DE</span> <span class="mi">62</span> <span class="mi">42</span> <span class="mi">18</span> <span class="n">FE</span> <span class="mi">9</span><span class="n">B</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">15</span> <span class="mi">3</span><span class="n">A</span> <span class="n">BB</span> <span class="mi">96</span> <span class="n">DB</span> <span class="mi">9</span><span class="n">E</span> <span class="mi">23</span> <span class="n">FD</span> <span class="mi">90</span> <span class="mi">10</span> <span class="mi">9</span><span class="n">B</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">0</span><span class="n">A</span> <span class="mi">89</span> <span class="mi">47</span> <span class="n">BD</span> <span class="mi">8</span><span class="n">E</span> <span class="mi">88</span> <span class="n">D6</span> <span class="n">F9</span> <span class="n">B9</span> <span class="mi">50</span> <span class="mi">76</span> <span class="n">E1</span> <span class="mi">0</span><span class="n">C</span> <span class="mi">4</span><span class="n">F</span> <span class="mi">89</span> <span class="mi">54</span> <span class="mi">9</span><span class="n">D</span> <span class="n">B1</span> <span class="n">F1</span> <span class="n">A6</span> <span class="mi">9</span><span class="n">B</span> <span class="mi">8</span><span class="n">A</span> <span class="mi">2</span><span class="n">C</span>
</code></pre></div> </div> </li> <li> <p>디버거에서 뽑은 값은 그대로 복사하면 안된다. 리틀 엔디언이라 순서가 바뀌므로 IDA의 Hex view→범위저장→ HXD로 열어서 복사의 과정을 거치자.</p> </li> </ul> <h1 id="4-구현-및-결과">4. 구현 및 결과</h1> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>        
<span class="kt">void</span> <span class="nf">rev1_sub_1215</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">xor</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rev2_sub_1447</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">table</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rev3_sub_14ed</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">table</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rev4_sub_15bb</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">rev4_1_sub_1545</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">rev4_2_sub_1580</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rev5_sub_16e0</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">x</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rev6_sub_172E</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="c1">// will be parsed and appended to the table1</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tmp1</span> <span class="o">=</span> <span class="s">"07 09 0E 01 0C 08 03 06 04 0A 02 0B 00 05 0F 0D 03 01 04 0A 02 06 0B 08 0F 09 0C 05 0E 00 0D 07 0A 0E 0D 04 05 06 08 03 0B 0F 09 01 0C 02 07 00 07 01 09 0A 05 06 0F 03 0D 02 0E 00 04 0C 08 0B"</span><span class="p">;</span>
    <span class="c1">// will be parsed and appended to the table2</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tmp2</span> <span class="o">=</span> <span class="s">"E9 10 8A 6D 2D 6C 45 61 0C F6 21 47 15 0E C8 25 9A E5 CA 53 18 07 F4 C3 FB 4C AC 34 31 38 D3 0A D5 22 0B C4 F5 F8 19 ED D0 42 F2 BE F8 4A 0B 37 B4 68 58 92 BB 47 E6 A5 4C 21 4D EC 8E 7A FA 2F"</span><span class="p">;</span>
    <span class="c1">// will be parsed and appended to the answer</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tmp3</span> <span class="o">=</span> <span class="s">"27 63 72 73 43 3F 9F 43 2E F0 33 F3 1E 07 0A 33 E5 6C DB 5F C9 11 DE 62 42 18 FE 9B 8E 15 3A BB 96 DB 9E 23 FD 90 10 9B 8E 0A 89 47 BD 8E 88 D6 F9 B9 50 76 E1 0C 4F 89 54 9D B1 F1 A6 9B 8A 2C"</span><span class="p">;</span>
    
    <span class="c1">//parsing </span>
    <span class="kt">int</span> <span class="n">tmp_len1</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">table1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">tmp_len1</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">));</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">table2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">tmp_len1</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">));</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">flag</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">tmp_len1</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">));</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">tmp_len1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hexByte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="sc">'0'</span><span class="p">};</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
        <span class="n">table1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">hexByte</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="c1">//printf("table1[%d]: %ldbyte, \\x0%x\n", i, sizeof(table1[i]), table1[i]);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">tmp_len1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hexByte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="sc">'0'</span><span class="p">};</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp2</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp2</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
        <span class="n">table2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">hexByte</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="c1">//printf("table1[%d]: %ldbyte, \\x0%x\n", i, sizeof(table1[i]), table1[i]);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">tmp_len1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">+=</span><span class="mi">3</span><span class="p">){</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hexByte</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="sc">'0'</span><span class="p">};</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp3</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp3</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">hexByte</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span><span class="n">strtol</span><span class="p">(</span><span class="n">hexByte</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
        <span class="c1">//printf("table1[%d]: %ldbyte, \\x0%x\n", i, sizeof(table1[i]), table1[i]);</span>
    <span class="p">}</span>

    <span class="n">rev6_sub_172E</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>

    <span class="n">rev5_sub_16e0</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>

    <span class="n">rev4_sub_15bb</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>

    <span class="n">rev3_sub_14ed</span><span class="p">(</span><span class="n">table2</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"14ed output: </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">"0x%02x "</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="n">rev2_sub_1447</span><span class="p">(</span><span class="n">flag</span><span class="o">+</span><span class="mi">48</span><span class="p">,</span> <span class="n">table1</span><span class="o">+</span><span class="mi">48</span><span class="p">);</span>
    <span class="n">rev2_sub_1447</span><span class="p">(</span><span class="n">flag</span><span class="o">+</span><span class="mi">32</span><span class="p">,</span> <span class="n">table1</span><span class="o">+</span><span class="mi">32</span><span class="p">);</span>
    <span class="n">rev2_sub_1447</span><span class="p">(</span><span class="n">flag</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span> <span class="n">table1</span><span class="o">+</span><span class="mi">16</span><span class="p">);</span>
    <span class="n">rev2_sub_1447</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">table1</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"1447 output: </span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">"0x%02x "</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="n">rev1_sub_1215</span><span class="p">(</span><span class="n">tmp_len1</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rev1_sub_1215</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">xor</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">len</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="o">*</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="n">i</span><span class="p">)</span><span class="o">^=</span><span class="n">xor</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rev2_sub_1447</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">table</span><span class="p">){</span>
    <span class="kt">char</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="sc">'0'</span><span class="p">};</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">tmp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=*</span><span class="p">(</span><span class="n">buf</span><span class="o">+*</span><span class="p">(</span><span class="n">table</span><span class="o">+</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
        <span class="o">*</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rev3_sub_14ed</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">table2</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">64</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^=</span><span class="n">table2</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rev4_sub_15bb</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">64</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">){</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rev4_1_sub_1545</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">64</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">){</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rev4_2_sub_1580</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">7</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">64</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">){</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rev4_1_sub_1545</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">64</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">4</span><span class="p">){</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rev4_2_sub_1580</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">rev4_1_sub_1545</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">){</span> <span class="c1">// 4k, 4k+2nd elements</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">-</span><span class="n">n</span><span class="p">)));</span>
<span class="p">}</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">rev4_2_sub_1580</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">){</span> <span class="c1">// 4k+1, 4k+3rd elements</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span><span class="o">-</span><span class="n">n</span><span class="p">)));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rev5_sub_16e0</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">64</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">x</span><span class="p">)</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 0x00~0xff hence, 0xff+1 == 0x00</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rev6_sub_172E</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+16h] [rbp-2h]</span>
    <span class="kt">char</span> <span class="n">k</span><span class="p">;</span> <span class="c1">// [rsp+16h] [rbp-2h]</span>
    <span class="kt">char</span> <span class="n">ii</span><span class="p">;</span> <span class="c1">// [rsp+16h] [rbp-2h]</span>
    <span class="kt">char</span> <span class="n">mm</span><span class="p">;</span> <span class="c1">// [rsp+16h] [rbp-2h]</span>
    <span class="kt">char</span> <span class="n">j</span><span class="p">;</span> <span class="c1">// [rsp+17h] [rbp-1h]</span>
    <span class="kt">char</span> <span class="n">m</span><span class="p">;</span> <span class="c1">// [rsp+17h] [rbp-1h]</span>
    <span class="kt">char</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// [rsp+17h] [rbp-1h]</span>
    <span class="kt">char</span> <span class="n">jj</span><span class="p">;</span> <span class="c1">// [rsp+17h] [rbp-1h]</span>
    <span class="kt">char</span> <span class="n">kk</span><span class="p">;</span> <span class="c1">// [rsp+17h] [rbp-1h]</span>
    <span class="kt">char</span> <span class="n">nn</span><span class="p">;</span> <span class="c1">// [rsp+17h] [rbp-1h]</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">63</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">48</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">nn</span> <span class="o">=</span> <span class="mi">47</span><span class="p">;</span> <span class="n">nn</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nn</span><span class="o">--</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">^=</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">ii</span> <span class="o">=</span> <span class="mi">47</span><span class="p">;</span> <span class="n">ii</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">;</span> <span class="n">ii</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">kk</span> <span class="o">=</span> <span class="mi">63</span><span class="p">;</span> <span class="n">kk</span> <span class="o">&gt;=</span> <span class="mi">48</span><span class="p">;</span> <span class="n">kk</span><span class="o">--</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">^=</span> <span class="n">buf</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">jj</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span> <span class="n">jj</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">jj</span><span class="o">--</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">^=</span> <span class="n">buf</span><span class="p">[</span><span class="n">ii</span><span class="p">];</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">;</span> <span class="n">k</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">63</span><span class="p">;</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">32</span><span class="p">;</span> <span class="n">n</span><span class="o">--</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">^=</span> <span class="n">buf</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">m</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span><span class="o">--</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">^=</span> <span class="n">buf</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">63</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">;</span> <span class="n">j</span><span class="o">--</span><span class="p">)</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^=</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div> <p>이것저것 시행착오를 거친 끝에 정답을 구할 수 있었다.</p> <p>정말 중요한 사실: char 타입은 음수가 될 경우 출력이나 연산에 사용 시 자동으로 int type로 전환되어 사용된다. 이걸 몰라서 한참 헤맸다.</p> <p>따라서 음수가 되는 경우를 무시하고 0x00~0xff 범위 내부를 순환하도록 하고 싶다면 char가 아닌 unsigned char로 정의하고, 함수에 인자를 전달할 때에도 반드시 해당 형식으로 전달해야 한다.</p> <p>파이썬으로 작성했다면 훨씬 편했을 텐데… 하…. 포인터를 쓰고 싶어서 C 언어로 작성하는 바람에 type 관련해서 정말 힘들었다.</p> <p>문제 정말 어렵더라. 더 화이팅 해보자!</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://localhost:4000/blog/paper_study/reversing/chaining" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About TouBVA </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="http://localhost:4000/assets/img/authors/toubva.jpeg" alt="TouBVA" /> </div> <div class="col-md-6"> <p class="author_bio">A Security Researcher, now concentrating on Security Consulting.</p> <p>Email : touBVa@gmail.com</p> <p>Website : https://toubva.github.io</p> <p class="profile-links"> <a class="social-link" href="https://github.com/TouBVa" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/johndoe" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.youtube.com/channel/UCSfLBFFfNU9r6ihfei6VeJw" target="_blank"><i class="fab fa-youtube fa-fw"></i></a> <a class="social-link" href="https://www.facebook.com/johndoe" target="_blank"><i class="fab fa-facebook fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/johndoe" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> </p> </div> </div> </div> </div> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <div id="disqus_thread", style="width: 90%; margin-left: 5%;"><script> var disqus_config = function () { this.page.url = "http://localhost:4000/blog/paper_study/reversing/chaining"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/paper_study/reversing/Reversing-Chaining"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://toubva.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About TouBVa</div> <div class="card-body"> <p class="author_bio">Welcome to my world!</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/touBVa/touBVa.github.io" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star my blog on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#dreamhack_system_hacking"></div> <li class="tag-head"> <a href="/blog/categories/dreamhack_system_hacking">dreamhack_system_hacking</a> </li> <a name="dreamhack_system_hacking"></a> <div id="#system_hacking"></div> <li class="tag-head"> <a href="/blog/categories/system_hacking">system_hacking</a> </li> <a name="system_hacking"></a> <div id="#protostar"></div> <li class="tag-head"> <a href="/blog/categories/protostar">protostar</a> </li> <a name="protostar"></a> <div id="#certification_study"></div> <li class="tag-head"> <a href="/blog/categories/certification_study">certification_study</a> </li> <a name="certification_study"></a> <div id="#paper_study"></div> <li class="tag-head"> <a href="/blog/categories/paper_study">paper_study</a> </li> <a name="paper_study"></a> <div id="#network_hacking"></div> <li class="tag-head"> <a href="/blog/categories/network_hacking">network_hacking</a> </li> <a name="network_hacking"></a> <div id="#blockchain"></div> <li class="tag-head"> <a href="/blog/categories/blockchain">blockchain</a> </li> <a name="blockchain"></a> <div id="#reversing"></div> <li class="tag-head"> <a href="/blog/categories/reversing">reversing</a> </li> <a name="reversing"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://localhost:4000/">Home</a> </li> <li> <a href="http://localhost:4000/about">About</a> </li> <li> <a href="http://localhost:4000/blog">Blog</a> </li> <li> <a href="http://localhost:4000/contact">Contact</a> </li> </div> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action=""method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup for Weekly Email Newsletters :D</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div><footer> <p> Powered by<a href="https://github.com/touBVa"> TouBVa</a>. Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="http://localhost:4000/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
